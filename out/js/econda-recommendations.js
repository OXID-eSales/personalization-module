(function(){var b=function(f,c){for(var a=c.exec(f),e=[],g;null!=a;)g=a.index,0!=g&&(f.substring(0,g),e.push(f.substring(0,g)),f=f.slice(g)),e.push(a[0]),f=f.slice(a[0].length),a=c.exec(f);""==!f&&e.push(f);return e},d=function(f,c){for(var a in c)c.hasOwnProperty(a)&&(f[a]=c[a])};EJS=function(f){f="string"==typeof f?{view:f}:f;this.set_options(f);if(f.precompiled)this.template={},this.template.process=f.precompiled,EJS.update(this.name,this);else{if(f.element){if("string"==typeof f.element){var c=
f.element;f.element=document.getElementById(f.element);if(null==f.element)throw c+"does not exist!";}this.text=f.element.value?f.element.value:f.element.innerHTML;this.name=f.element.id;this.type="["}else if(f.url){f.url=EJS.endExt(f.url,this.extMatch);this.name=this.name?this.name:f.url;var c=f.url,a=EJS.get(this.name,this.cache);if(a)return a;if(a==EJS.INVALID_PATH)return null;try{this.text=EJS.request(c+(this.cache?"":"?"+Math.random()))}catch(e){}if(null==this.text)throw{type:"EJS",message:"There is no template at "+
c};}a=new EJS.Compiler(this.text,this.type);a.compile(f,this.name);EJS.update(this.name,this);this.template=a}};EJS.prototype={render:function(f,c){f=f||{};this._extra_helpers=c;var a=new EJS.Helpers(f,c||{});return this.template.process.call(f,f,a)},update:function(f,c){"string"==typeof f&&(f=document.getElementById(f));if(null==c)return _template=this,function(a){EJS.prototype.update.call(_template,f,a)};"string"==typeof c?(params={},params.url=c,_template=this,params.onComplete=function(a){a=eval(a.responseText);
EJS.prototype.update.call(_template,f,a)},EJS.ajax_request(params)):f.innerHTML=this.render(c)},out:function(){return this.template.out},set_options:function(f){this.type=f.type||EJS.type;this.cache=null!=f.cache?f.cache:EJS.cache;this.text=f.text||null;this.name=f.name||null;this.ext=f.ext||EJS.ext;this.extMatch=RegExp(this.ext.replace(/\./,"."))}};EJS.endExt=function(f,c){if(!f)return null;c.lastIndex=0;return f+(c.test(f)?"":this.ext)};EJS.Scanner=function(f,c,a){d(this,{left_delimiter:c+"%",right_delimiter:"%"+
a,double_left:c+"%%",double_right:"%%"+a,left_equal:c+"%=",left_comment:c+"%#"});this.SplitRegexp="["==c?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)");this.source=f;this.stag=null;this.lines=0};EJS.Scanner.to_text=function(f){return null==f||void 0===f?"":f instanceof Date?f.toDateString():f.toString?
f.toString():""};EJS.Scanner.prototype={scan:function(f){scanline=this.scanline;regex=this.SplitRegexp;if(""==!this.source)for(var c=b(this.source,/\n/),a=0;a<c.length;a++)this.scanline(c[a],regex,f)},scanline:function(f,c,a){this.lines++;f=b(f,c);for(c=0;c<f.length;c++){var e=f[c];if(null!=e)try{a(e,this)}catch(g){throw{type:"EJS.Scanner",line:this.lines};}}}};EJS.Buffer=function(f,c){this.line=[];this.script="";this.pre_cmd=f;this.post_cmd=c;for(var a=0;a<this.pre_cmd.length;a++)this.push(f[a])};
EJS.Buffer.prototype={push:function(f){this.line.push(f)},cr:function(){this.script+=this.line.join("; ");this.line=[];this.script+="\n"},close:function(){if(0<this.line.length){for(var f=0;f<this.post_cmd.length;f++)this.push(pre_cmd[f]);this.script+=this.line.join("; ");line=null}}};EJS.Compiler=function(f,c){this.pre_cmd=["var ___ViewO = [];"];this.post_cmd=[];this.source=" ";null!=f&&("string"==typeof f?(f=f.replace(/\r\n/g,"\n"),this.source=f=f.replace(/\r/g,"\n")):f.innerHTML&&(this.source=
f.innerHTML),"string"!=typeof this.source&&(this.source=""));var c=c||"<",a=">";switch(c){case "[":a="]";break;case "<":break;default:throw c+" is not a supported deliminator";}this.scanner=new EJS.Scanner(this.source,c,a);this.out=""};EJS.Compiler.prototype={compile:function(f,c){f=f||{};this.out="";var a=new EJS.Buffer(this.pre_cmd,this.post_cmd),e="",g=function(a){a=a.replace(/\\/g,"\\\\");a=a.replace(/\n/g,"\\n");return a=a.replace(/"/g,'\\"')};this.scanner.scan(function(c,b){if(null==b.stag)switch(c){case "\n":e+=
"\n";a.push('___ViewO.push("'+g(e)+'");');a.cr();e="";break;case b.left_delimiter:case b.left_equal:case b.left_comment:b.stag=c;0<e.length&&a.push('___ViewO.push("'+g(e)+'")');e="";break;case b.double_left:e+=b.left_delimiter;break;default:e+=c}else switch(c){case b.right_delimiter:switch(b.stag){case b.left_delimiter:"\n"==e[e.length-1]?(e=e.substr(0,e.length-1),a.push(e),a.cr()):a.push(e);break;case b.left_equal:a.push("___ViewO.push((EJS.Scanner.to_text("+e+")))")}b.stag=null;e="";break;case b.double_right:e+=
b.right_delimiter;break;default:e+=c}});0<e.length&&a.push('___ViewO.push("'+g(e)+'")');a.close();this.out=a.script+";";var b="/*"+c+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(b)}catch(d){if("undefined"!=typeof JSLINT){JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++)if(b=JSLINT.errors[i],"Unnecessary semicolon."!=b.reason)throw b.line++,i=Error(),i.lineNumber=b.line,
i.message=b.reason,f.view&&(i.fileName=f.view),i;}else throw d;}}};EJS.config=function(b){EJS.cache=null!=b.cache?b.cache:EJS.cache;EJS.type=null!=b.type?b.type:EJS.type;EJS.ext=null!=b.ext?b.ext:EJS.ext;var c=EJS.templates_directory||{};EJS.templates_directory=c;EJS.get=function(a,e){return!1==e?null:c[a]?c[a]:null};EJS.update=function(a,e){null!=a&&(c[a]=e)};EJS.INVALID_PATH=-1};EJS.config({cache:!0,type:"<",ext:".htm"});EJS.Helpers=function(b,c){this._data=b;this._extras=c;d(this,c)};EJS.Helpers.prototype=
{view:function(b,c,a){a||(a=this._extras);c||(c=this._data);return(new EJS(b)).render(c,a)},to_text:function(b,c){return null==b||void 0===b?c||"":b instanceof Date?b.toDateString():b.toString?b.toString().replace(/\n/g,"<br />").replace(/''/g,"'"):""}};EJS.newRequest=function(){for(var b=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<b.length;c++)try{var a=b[c]();if(null!=a)return a}catch(e){}};
EJS.request=function(b){var c=new EJS.newRequest;c.open("GET",b,!1);try{c.send(null)}catch(a){return null}return 404==c.status||2==c.status||0==c.status&&""==c.responseText?null:c.responseText};EJS.ajax_request=function(b){b.method=b.method?b.method:"GET";var c=new EJS.newRequest;c.onreadystatechange=function(){if(4==c.readyState)b.onComplete(c)};c.open(b.method,b.url);c.send(null)}})();var __extends=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,f){b.__proto__=f}||function(b,f){for(var c in f)f.hasOwnProperty(c)&&(b[c]=f[c])};return function(d,f){function c(){this.constructor=d}b(d,f);d.prototype=null===f?Object.create(f):(c.prototype=f.prototype,new c)}}(),econda;(function(b){var b=b.recengine||(b.recengine={}),d=function(){};d.currentVersion=function(){return"3.0.16"};b.Version=d})(econda||(econda={}));
(function(b){var b=b.util||(b.util={}),d=function(){};d.trim=function(b){this.trim="function"!==typeof String.prototype.trim?function(c){return String(c).replace(/^\s+|\s+$/g,"")}:function(c){return String(c).trim()};return this.trim(b)};d.html=function(b){var c=this;return String(b).replace(/[&<>"'\/]/g,function(a){return c._entityMap[a]})};d.truncate=function(b,c){void 0===c&&(c=null);var c=c?c:{},a=c.maxLength||100,e=!0==c.wordBoundaries,g=c.ellipsis||" ...",d=c.minLength||1,h=a-g.length;b.length>
a?(a=b.substr(0,h),e&&(e=a.lastIndexOf(" ")-1,e>=d&&(a=a.substr(0,e))),a+=g):a=b;return a};d.ucFirst=function(b){return b.charAt(0).toUpperCase()+b.slice(1)};d._entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};b.StringUtils=d})(econda||(econda={}));
(function(b){var b=b.util||(b.util={}),d=function(){};d._useJQuery=function(){return this.useJQueryIfLoaded&&"undefined"!=typeof jQuery};d.update=function(b,c){return this._useJQuery()?jQuery(b).html(c):this._update(b,c)};d.createFragmentFromHtml=function(b){var c=document.createDocumentFragment(),a=document.createElement("div");for(a.innerHTML=b;a.firstChild;)c.appendChild(a.firstChild);return c};d.appendFromHtml=function(b,c){var a=document.createElement("div");for(a.innerHTML=c;a.firstChild;)if("script"===
String(a.firstChild.nodeName).toLowerCase()){var e=a.firstChild.textContent||a.firstChild.innerHTML,g=document.createElement("script");g.type="text/javascript";if(a.children[0].getAttribute("src"))g.src=a.children[0].getAttribute("src");else try{g.appendChild(document.createTextNode(e))}catch(d){g.text=e}b.appendChild(g);a.removeChild(a.firstChild)}else b.appendChild(a.firstChild)};d.empty=function(b){for(b=d.element(b);b.firstChild;)b.removeChild(b.firstChild)};d._update=function(b,c){var a=this.element(b),
e=null;a&&(a.innerHTML=c,this._handleJavascript(a),e=a.innerHTML);return e};d._handleJavascript=function(b){var c,a,e=b.getElementsByTagName("script");if(0<e.length){c=0;for(a=e.length;c<a;c+=1){var g=this._generateScriptNode(e[c].text||e[c].textContent||e[c].innerHTML||"");b.appendChild(g)}}};d._generateScriptNode=function(b){var c=document.createElement("script");c.type="text/javascript";c.appendChild(document.createTextNode(b));return c};d.isDocumentReady=function(){return"complete"===document.readyState||
"interactive"===document.readyState};d.documentReady=function(b){function c(){a||(a=!0,b())}if(d.isDocumentReady())b();else{var a=!1,e=!1,g=document,j=window;if(g.addEventListener)g.addEventListener("DOMContentLoaded",c,!1);else if(g.attachEvent){try{e=null!=window.frameElement}catch(h){}if(g.documentElement&&g.documentElement.doScroll&&!e){var i=function(){if(!a)try{g.documentElement.doScroll("left"),c()}catch(e){setTimeout(i,10)}};i()}g.attachEvent("onreadystatechange",function(){("complete"===
g.readyState||"interactive"===g.readyState)&&c()})}if(j.addEventListener)j.addEventListener("load",c,!1);else if(j.attachEvent)j.attachEvent("onload",c);else{var k=j.onload;j.onload=function(){k&&k(null);c()}}}};d.remove=function(b){(b=this.element(b))&&b.parentNode.removeChild(b)};d.elements=function(b){var c=null;return this._useJQuery()?jQuery(b):(c="string"==typeof b?"#"==b.substr(0,1)?document.getElementById(b.substr(1)):document.getElementById(b):b)?[c]:{length:0}};d.element=function(b){b=this.elements(b);
return 0<b.length?b[0]:null};d.useJQueryIfLoaded=!0;b.DomHelper=d})(econda||(econda={}));
(function(b){var d=b.util||(b.util={}),f=function(a,e,c,b){this.timestamp=null;this.type="info";this.data=this.message=null;this.timestamp=a;this.type=e;this.message=c;this.data=b};f.TYPE_INFO="info";f.TYPE_WARNING="warning";f.TYPE_ERROR="error";var c=function(){this.container=null;this.autoScroll=!0;this.queue=[];this.timeout=null};c.prototype.log=function(a,e){var c=new f(new Date,f.TYPE_INFO,a,e);this.queue.push(c);this.writeQueue()};c.prototype.warn=function(a,e){var c=new f(new Date,f.TYPE_WARNING,
a,e);this.queue.push(c);this.writeQueue()};c.prototype.error=function(a,e){var c=new f(new Date,f.TYPE_ERROR,a,e);this.queue.push(c);this.writeQueue()};c.prototype.writeQueue=function(){var a=b.util.DomHelper.element(this.container);if(null!=a)for(var e=null;e=this.queue.shift();)this.writeItemToContainer(e,a);else if(null==this.timeout){var c=this;setTimeout(function(){c.writeQueue()},250)}};c.prototype.writeItemToContainer=function(a,e){var c=a.timestamp.getMinutes(),c=10>c?"0"+c.toString():c.toString(),
c=[a.timestamp.getHours().toString(),":",c,".",a.timestamp.getSeconds().toString()," - ",a.message],b=document.createElement("p");b.innerHTML=c.join("");b.style.margin="0";b.style.padding="2px";b.style.fontFamily="Fixed, monospace";b.style.fontSize="12px";switch(a.type){case f.TYPE_ERROR:b.style.backgroundColor="#FF9999";break;case f.TYPE_WARNING:b.style.backgroundColor="#FFFF99"}e.appendChild(b);this.autoScroll&&(e.scrollTop=e.scrollHeight)};c.prototype.getContainerElement=function(){var a=null;
return a=this.container instanceof HTMLElement?this.container:document.getElementById(this.container)};d.LogViewer=c})(econda||(econda={}));
(function(b){var b=b.net||(b.net={}),d=function(b){this.hash=this.query=this.path=this.host=this.scheme=this.uri=null;if(b instanceof d)return b;(this.uri=b)&&this.parseUri()};d.prototype.getScheme=function(){return this.scheme?this.scheme.toLowerCase():null};d.prototype.setScheme=function(b){b=(new String(b)).toLocaleLowerCase();null!==this.uri&&(this.uri=this.uri.replace(/^\w*\:/,b+":"));this.resetComponents();this.parseUri()};d.prototype.getHost=function(){return this.host};d.prototype.getPath=
function(){return this.path};d.prototype.getFilename=function(){var b=this.path;return"string"==typeof b&&-1<b.lastIndexOf("/")?b.substr(b.lastIndexOf("/")+1):null};d.prototype.getQuery=function(){return this.query};d.prototype.getHash=function(){return this.hash};d.prototype.parseUri=function(){var b=this.uri.match(/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);this.scheme=b[1]||null;this.host=b[2]||null;this.path=b[3]||null;this.query=b[4]||null;this.hash=b[5]||null;return this};
d.prototype.resetComponents=function(){this.hash=this.query=this.path=this.host=this.scheme=null;return this};d.prototype.getParam=function(b){var c=[];"string"===typeof this.query&&(c=this.query.split("&"));for(var a={},e=0;e<c.length;e++){var g=String(c[e]).split("=");a[g[0]]=2<=g.length?g[1]:""}return a[b]||null};d.prototype.appendParams=function(b){var c=this.uri,a=c.lastIndexOf("#"),e=-1<a?c.substring(0,a):c,a=-1<a?c.substr(a):"",c=-1<c.indexOf("?");this.uri=e+(c?"&":"?")+d.concatParams(b)+a;
this.resetComponents();this.parseUri();return this};d.prototype.match=function(b){return this.uri.match(b)};d.prototype.clone=function(){return new d(this.uri)};d.concatParams=function(b){var c=[],a;for(a in b)c.push(a+"="+encodeURIComponent(b[a]));return c.join("&")};d.detectProtocol=function(){return"string"===typeof location.protocol&&"https:"===location.protocol?"https":"http"};d.prototype.toString=function(){return this.uri};d.SCHEME_HTTP="http";d.SCHEME_HTTPS="https";d.SCHEME_FTP="ftp";b.Uri=
d})(econda||(econda={}));"undefined"==typeof window.econdaConfig&&(window.econdaConfig={});
(function(b){var d=function(){};d.setEnabled=function(b){econdaConfig.debug=b;return this};d.getEnabled=function(){return econdaConfig.debug};d.setExceptionsOnError=function(b){econdaConfig.exceptionsOnError=b;return this};d.getExceptionsOnError=function(){return econdaConfig.exceptionsOnError||!1};d.setOutputContainer=function(b){econdaConfig.debugOutputContainer=b;this.logViewerInstance=null;return this};d.error=function(){for(var b=0;b<arguments.length;b++);if(!0!=econdaConfig.debug)return this;
for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);"undefined"!=typeof console&&console.error&&console.error("[ec] "+arguments[0],b);null!=econdaConfig.debugOutputContainer&&(this.setupLogViewer(),this.logViewerInstance.error(arguments[0],b));if(econdaConfig.exceptionsOnError)throw Error(arguments[0]);return this};d.warn=function(){for(var b=0;b<arguments.length;b++);if(!0!=econdaConfig.debug)return this;for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);"undefined"!=typeof console&&
console.warn&&console.warn("[ec] "+arguments[0],b);null!=econdaConfig.debugOutputContainer&&(this.setupLogViewer(),this.logViewerInstance.warn(arguments[0],b));return this};d.log=function(){for(var b=0;b<arguments.length;b++);if(!0!=econdaConfig.debug)return this;for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);"undefined"!=typeof console&&console.log&&(0<b.length?console.log("[ec] "+arguments[0],b):console.log("[ec] "+arguments[0]));null!=econdaConfig.debugOutputContainer&&(this.setupLogViewer(),
this.logViewerInstance.log(arguments[0],b));return this};d.setupLogViewer=function(){null==this.logViewerInstance&&(this.logViewerInstance=new b.util.LogViewer,this.logViewerInstance.container=econdaConfig.debugOutputContainer)};d.logViewerInstance=null;b.debug=d})(econda||(econda={}));
(function(b){var b=b.util||(b.util={}),d=function(){};d.indexOf=function(b,c){if(Array.prototype.indexOf)return b.indexOf(c);for(var a=0;a<b.length;a++)if(b[a]==c)return a;return-1};d.contains=function(b,c){return-1<d.indexOf(b,c)};d.isArray=function(b){this.isArrayFn||(this.isArrayFn="undefined"!=typeof Array.isArray?Array.isArray:function(c){return"[object Array]"===Object.prototype.toString.call(c)});return this.isArrayFn(b)};d.shuffle=function(b){for(var c=b.length,a,e;c;)e=Math.floor(Math.random()*
c--),a=b[c],b[c]=b[e],b[e]=a;return b};d.remove=function(b,c){if("function"===typeof c)return this._removeByFunction(b,c);var a=d.isArray(c)?c:[c];return this._removeItems(b,a)};d._removeItems=function(b,c){for(var a=[],e=0;e<c.length;e++){var g=b.indexOf(c[e]);-1<g&&(a=a.concat(b.splice(g,1)))}return a};d._removeByFunction=function(b,c){for(var a=[],e=0;e<b.length;e++)!0===c(b[e],e,b)&&(a=a.concat(b.splice(e,1)),e--);return a};d.filter=function(b,c){if("function"!==typeof c)return b;if("function"===
typeof b.filter)return b.filter(c);for(var a=[],e=0;e<b.length;e++)!0===c(b[e],e,b)&&a.push(b[e]);return a};d.isArrayFn=null;b.ArrayUtils=d})(econda||(econda={}));
(function(b){var d=b.base||(b.base={}),f=function(){this.__defaultProperty=null};f.prototype.initConfig=function(c,a){void 0===a&&(a=null);null!=a&&(this.__defaultProperty=a);"undefined"!=typeof c&&this.set(c)};f.prototype.set=function(c,a){var e,g;if("object"==typeof c)for(e in c)if(g=this.getSetterName(e),"undefined"!=typeof this[g])this[g](c[e]);else b.debug.error("Cannot set "+e+" in "+this._getClassName()+": no setter defined.");else if("string"==typeof c&&2==arguments.length)if(e=c,g=this.getSetterName(e),
"undefined"!=typeof this[g])this[g](a);else b.debug.error("Cannot set "+e+" in "+this._getClassName()+": no setter defined.");else"undefined"!=typeof c&&this.__defaultProperty&&(g=this.getSetterName(this.__defaultProperty),this[g](c));return this};f.prototype.get=function(c){var a=this.getGetterName(c);if("undefined"!=typeof this[a])return this[a]();b.debug.error("Cannot get "+c+" in "+this._getClassName()+": no getter defined.")};f.prototype._getClassName=function(){try{return this.constructor.name}catch(c){return null}};
f.prototype.getSetterName=function(c){return"set"+c.substr(0,1).toUpperCase()+c.substr(1)};f.prototype.getGetterName=function(c){return"get"+c.substr(0,1).toUpperCase()+c.substr(1)};f.prototype.setArray=function(c,a,e,b){void 0===e&&(e=null);this[c]=[];this.addArray(c,a,e,b);return this};f.prototype.addArray=function(c,a,e,g){void 0===e&&(e=null);if("undefined"===typeof g||null===g)g={};var d=a;!1==b.util.ArrayUtils.isArray(a)&&(d=[a]);for(a=0;a<d.length;a++){var f;f="function"===typeof g.itemFilter?
g.itemFilter.call(this,d[a]):d[a];f=null===e||f instanceof e?f:new e(f);"function"===typeof g.callback&&g.callback.call(this,f);this[c].push(f)}return this};f.prototype.clone=function(){var c=new this.constructor,a;for(a in this)c[a]=this[a];return c};d.BaseClass=f})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.response||(d.response={}),f=b.base.BaseClass,c=function(a){void 0===a&&(a=null);var e=f.call(this)||this;e.emcs=null;e.emcs0=null;e.emcs1=null;if(a instanceof c)return a;a&&e.initConfig(a);return e};__extends(c,f);c.prototype.setEmcs=function(a){this.emcs=a;return this};c.prototype.getEmcs=function(){return this.emcs};c.prototype.getEmcs0=function(){return this.emcs0};c.prototype.setEmcs0=function(a){this.emcs0=a;return this};c.prototype.getEmcs1=
function(){return this.emcs1};c.prototype.setEmcs1=function(a){this.emcs1=a;return this};d.Tracking=c})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),f=d.response||(d.response={}),c=b.base.BaseClass,a=function(e){void 0===e&&(e=null);var b=c.call(this)||this;b._title=null;b._disableOnEmpty=!0;b._tracking=null;b._deeplinkFallbackUrl=null;if(e instanceof a)return e;e&&b.initConfig(e);return b};__extends(a,c);a.prototype.getTitle=function(){return this._title};a.prototype.setTitle=function(a){this._title=a};a.prototype.getDisableOnEmpty=function(){return this._disableOnEmpty};a.prototype.setDisableonempty=
function(a){this._disableOnEmpty=a};a.prototype.setDisableOnEmpty=function(a){this._disableOnEmpty=a};a.prototype.getTracking=function(a){void 0===a&&(a=!1);return a&&null===this._tracking?new f.Tracking:this._tracking};a.prototype.setTracking=function(a){this._tracking=new f.Tracking(a)};a.prototype.setDeeplinkfallbackurl=function(a){this._deeplinkFallbackUrl=a};a.prototype.setDeeplinkFallbackUrl=function(a){this._deeplinkFallbackUrl=a};a.prototype.getDeeplinkFallbackUrl=function(){return this._deeplinkFallbackUrl};
f.WidgetDetails=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.response||(d.response={}),f=b.recengine.response.WidgetDetails,c=b.base.BaseClass,a=function(e){var b=c.call(this)||this;b._isError=!1;b._request=null;b._startIndex=0;b._endIndex=null;b.products=[];b.widgetDetails=null;if(e instanceof a)return e;b.initConfig(e);return b};__extends(a,c);a.prototype.getIsError=function(){return this._isError};a.prototype.setIsError=function(a){this._isError=a;return this};a.prototype.getRequest=function(){return this._request};
a.prototype.setRequest=function(a){this._request=a;return this};a.prototype.getStartIndex=function(){return this._startIndex};a.prototype.setStartIndex=function(a){this._startIndex=a;return this};a.prototype.getEndIndex=function(){return this._endIndex};a.prototype.setEndIndex=function(a){this._endIndex=a;return this};a.prototype.getProducts=function(){return this.products};a.prototype.setProducts=function(a){this.products=a;return this};a.prototype.setWidgetDetails=function(a){this.widgetDetails=
new f(a)};a.prototype.getWidgetDetails=function(a){void 0===a&&(a=!1);return a&&null===this.widgetDetails?new f:this.widgetDetails};d.Response=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.decorator||(d.decorator={}),f=b.base.BaseClass,c=function(){var a=null!==f&&f.apply(this,arguments)||this;a.request=null;a.fields={};a.response=null;return a};__extends(c,f);c.prototype.getRequest=function(){return this.request};c.prototype.setRequest=function(a){this.request=a;return this};c.prototype.getFields=function(){var a=[],e;for(e in this.fields)a.push(e);return this.fields};c.prototype.setFields=function(a){this.fields=b.util.ArrayUtils.isArray(a)?
a:[a];return this};c.prototype.decorate=function(a){this.response=a;for(var a=a.getProducts(),e=0;e<a.length;e++){var c=a[e];this.decorateProduct(c);for(var b=0;b<this.fields.length;b++)"undefined"!=typeof c[this.fields[b]]&&(c[this.fields[b]]=this.decorateField(c[this.fields[b]],c,this.fields[b]))}};c.prototype.decorateProduct=function(){};c.prototype.decorateField=function(){};d.AbstractFieldDecorator=c})(econda||(econda={}));
(function(b){var b=b.util||(b.util={}),d=function(){};d.appendParams=function(b,c){return(0<b.indexOf("?")?b+"&":b+"?")+d.concatParams(c)};d.concatParams=function(b){var c=[],a;for(a in b)c.push(a+"="+encodeURIComponent(b[a]));return c.join("&")};b.UriUtils=d})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.decorator||(d.decorator={}),f=b.util.UriUtils,c=d.AbstractFieldDecorator,a=function(e){void 0===e&&(e=null);var b=c.call(this)||this;b.fields=["deeplink"];b.widgetName=null;b.source=null;b.position=null;if(e instanceof a)return e;b.initConfig(e);return b};__extends(a,c);a.prototype.getWidgetName=function(){return this.widgetName};a.prototype.setWidgetName=function(a){this.widgetName=a;return this};a.prototype.getSource=function(){return this.source};
a.prototype.setSource=function(a){this.source=a;return this};a.prototype.getPosition=function(){return this.position};a.prototype.setPosition=function(a){this.position=a;return this};a.prototype._getTrackingParams=function(a){var c=this.getRequest();return{emcs0:this.getWidgetName()||c.getWidgetId(),emcs1:this.getPosition(),emcs2:this.getSource(),emcs3:a.id}};a.prototype.decorateProduct=function(a){a.trackingparameters=f.concatParams(this._getTrackingParams(a))};a.prototype.decorateField=function(a,
c){return f.appendParams(a,this._getTrackingParams(c))};d.PerformanceTracking=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.decorator||(d.decorator={}),f=b.util.ArrayUtils,c=b.base.BaseClass,a=function(e){void 0===e&&(e=null);var b=c.call(this)||this;b.request=null;if(e instanceof a)return e;b.initConfig(e);return b};__extends(a,c);a.prototype.getRequest=function(){return this.request};a.prototype.setRequest=function(a){this.request=a;return this};a.prototype.decorate=function(a){a=a.getProducts();f.shuffle(a)};d.ProductListRandomizer=a})(econda||(econda={}));
(function(b){var d=b.collection||(b.collection={}),f=b.util.ArrayUtils,c=function(a){this._items=[];this._itemsById={};this._idProperty=null;this.onChange=[];if(a instanceof c)return a;"object"===typeof a&&(this._idProperty=a.idProperty||null,this._items=[],"undefined"!==typeof a.items&&this._setItems(a.items),"undefined"!==typeof a.onChange&&this.setOnChange(a.onChange))};c.prototype.setOnChange=function(a){f.isArray(a)?this.onChange=a:this.onChange=[a]};c.prototype._fireOnChangeEvent=function(a){for(var e=
0;e<this.onChange.length;e++)this.onChange[e](a)};c.prototype.add=function(a){this._items.push(a);null!==this._idProperty&&"undefined"!=typeof a[this._idProperty]&&(this._itemsById[""+a[this._idProperty]]=a);this._collectionChanged();this._fireOnChangeEvent(a);return this};c.prototype.contains=function(a){return f.contains(this._items,a)};c.prototype.length=function(){return this._items.length};c.prototype.sort=function(a){a="string"===typeof a?this._createCompareFunction(a):a;return this._items.sort(a)};
c.prototype._createCompareFunction=function(a){return function(e,c){return e[a]>c[a]?1:e[a]<c[a]?-1:0}};c.prototype.indexOf=function(a){return f.indexOf(this._items,a)};c.prototype.getItemById=function(a){return"undefined"===typeof this._itemsById[""+a]?null:this._itemsById[""+a]};c.prototype.get=function(a){return"undefined"!==typeof this._items[a]?this._items[a]:null};c.prototype.getAll=function(){return this._items};c.prototype.getFilteredItems=function(a){var e=[];if("function"===typeof a.match)for(var c=
0;c<this._items.length;c++)!0===a.match(this._items[c])&&e.push(this._items[c]);else for(c=0;c<this._items.length;c++)!0===a(this._items[c])&&e.push(this._items[c]);return e};c.prototype.forEach=function(a,e){for(var c=0;c<this._items.length;c++)a.call(e,this._items[c])};c.prototype.clear=function(){this._setItems(null);return this};c.prototype._setItems=function(a){this._items=[];this._itemsById={};if(null!==a){if("undefined"!==typeof a.length)this._items=a;else if("object"===typeof a)for(var e in a)a.hasOwnProperty(e)&&
this._items.push(a[e]);if(null!==this._idProperty)for(a=0;a<this._items.length;a++)this._itemsById[""+this._items[a][this._idProperty]]=this._items[a];this._collectionChanged();this.forEach(this._fireOnChangeEvent,this)}};c.prototype._collectionChanged=function(){};d.List=c})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.event||(d.event={}),f=b.base.BaseClass,b=function(){var c=null!==f&&f.apply(this,arguments)||this;c._timestamp=new Date;return c};__extends(b,f);b.prototype.getType=function(){return this.constructor.TYPE};b.prototype.getTimestamp=function(){return this._timestamp};b.prototype.setTimestamp=function(c){this._timestamp=c};b.TYPE=null;d.AbstractEvent=b})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.context||(d.context={}),f=b.base.BaseClass,c=function(a){var e=f.call(this)||this;e._id=null;e._sku=null;if(a instanceof c)return a;e.initConfig(a);return e};__extends(c,f);c.prototype.getId=function(){return this._id};c.prototype.setId=function(a){this._id=a;return this};c.prototype.getSku=function(){return this._sku};c.prototype.setSku=function(a){this._sku=a;return this};c.prototype.getObjectData=function(){return{className:"econda.recengine.context.ProductReference",
data:{id:this._id,sku:this._sku}}};c.prototype.setObjectData=function(a){"object"===typeof a&&null!==a&&(this._id=a.id||null,this._sku=a.sku||null)};d.ProductReference=c})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.event||(d.event={}),f=b.recengine.context.ProductReference,c=b.recengine.event.AbstractEvent,a=function(e){var b=c.call(this)||this;b._count=1;b._product=null;if(e instanceof a)return e;b.initConfig(e);return b};__extends(a,c);a.prototype.getCount=function(){return this._count};a.prototype.setCount=function(a){this._count=+a};a.prototype.getProduct=function(){return this._product};a.prototype.setProduct=function(a){this._product=new f(a)};a.prototype.getObjectData=
function(){return{className:"econda.recengine.event.ProductAddToCartEvent",data:{timestamp:this.getTimestamp(),count:this._count,product:this._product}}};a.prototype.setObjectData=function(a){"object"===typeof a&&null!==a&&(this.setTimestamp(a.timestamp),this._count=a.count||1,this._product=a.product||null)};a.TYPE="product:add";d.ProductAddToCartEvent=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.event||(d.event={}),f=b.recengine.context.ProductReference,c=b.recengine.event.AbstractEvent,a=function(e){var b=c.call(this)||this;b._count=1;b._product=null;if(e instanceof a)return e;b.initConfig(e);return b};__extends(a,c);a.prototype.getCount=function(){return this._count};a.prototype.setCount=function(a){this._count=+a};a.prototype.getProduct=function(){return this._product};a.prototype.setProduct=function(a){this._product=new f(a)};a.prototype.getObjectData=
function(){return{className:"econda.recengine.event.ProductBuyEvent",data:{timestamp:this.getTimestamp(),count:this._count,product:this._product}}};a.prototype.setObjectData=function(a){"object"===typeof a&&null!==a&&(this.setTimestamp(a.timestamp),this._count=a.count||1,this._product=a.product||null)};a.TYPE="product:buy";d.ProductBuyEvent=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.event||(d.event={}),f=b.recengine.context.ProductReference,c=b.recengine.event.AbstractEvent,a=function(e){var b=c.call(this)||this;b._product=null;if(e instanceof a)return e;b.initConfig(e);return b};__extends(a,c);a.prototype.getProduct=function(){return this._product};a.prototype.setProduct=function(a){this._product=new f(a)};a.prototype.getObjectData=function(){return{className:"econda.recengine.event.ProductViewEvent",data:{timestamp:this.getTimestamp(),
product:this._product}}};a.prototype.setObjectData=function(a){"object"===typeof a&&null!==a&&(this.setTimestamp(a.timestamp),this._product=a.product||null)};a.TYPE="product:view";d.ProductViewEvent=a})(econda||(econda={}));
(function(b){var d=b.cookie||(b.cookie={}),f=b.base.BaseClass,c=function(a){var e=f.call(this)||this;e._name="";e._value="";e._domain="";e._path="/";e._expires=null;e._secure=!1;if(a instanceof c)return a;e.initConfig(a);return e};__extends(c,f);c.prototype.getName=function(){return this._name};c.prototype.setName=function(a){this._name=a;return this};c.prototype.getValue=function(){return this._value};c.prototype.setValue=function(a){this._value=a;return this};c.prototype.getDomain=function(){return this._domain};
c.prototype.setDomain=function(a){this._domain=a;return this};c.prototype.getPath=function(){return this._path};c.prototype.setPath=function(a){this._path=a;return this};c.prototype.getExpires=function(){return this._expires};c.prototype.setExpires=function(a){var e;"number"==typeof a?(e=new Date,e.setDate(e.getDate()+a)):e=a;this._expires=e;return this};c.prototype.getSecure=function(){return this._secure};c.prototype.setSecure=function(a){this._secure=a;return this};d.Cookie=c})(econda||(econda=
{}));
(function(b){var d=b.cookie||(b.cookie={}),f=function(){};f.contains=function(c){return"undefined"===typeof document.cookie?!1:RegExp("(?:;\\s*|^)"+encodeURIComponent(c)+"=").test(document.cookie)};f.find=function(c){if("undefined"===typeof document.cookie)return{};for(var a=document.cookie.split(";"),e,b={},d=0,f=a.length;d<f;++d){e=a[d].split("=");var i=e[0].replace(/^\s+|\s+$/,"");e=e.slice(1).join("=");if(!1==c instanceof RegExp||c.test(i))b[decodeURIComponent(i)]=decodeURIComponent(e)}return b};f.getValue=
function(c){return b.cookie.Store.contains(c)?b.cookie.Store.find(c)[c]:null};f.set=function(c,a){void 0===a&&(a=!0);if("undefined"===typeof document.cookie)return this;var e=new b.cookie.Cookie(c),g=e.getName(),d=e.getValue(),f=e.getPath(),i=e.getDomain(),k=e.getExpires(),e=e.getSecure(),g=[encodeURIComponent(g)+"="+(a?encodeURIComponent(d):d)];f&&g.push("path="+f);i&&g.push("domain="+i);k&&g.push("expires="+k.toUTCString());e&&g.push("secure");document.cookie=g.join(";");return this};f.remove=function(c){if("undefined"===
typeof document.cookie)return this;var a;a="string"===typeof c?new b.cookie.Cookie({name:c}):new b.cookie.Cookie(c);var e=a.getName(),c=a.getPath(),g=a.getDomain();a=a.getSecure();e=[encodeURIComponent(e)+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"];c&&e.push("path="+c);g&&e.push("domain="+g);a&&e.push("secure");document.cookie=e.join(";");return this};d.Store=f})(econda||(econda={}));
(function(b){var d=b.tracking||(b.tracking={}),f=b.cookie.Store,b=function(c){this.globalConfigProperties=c;for(var a in c)this[a]=c[a]};b.prototype.getPidIndex=function(){return this.PRODUCT_ID_IN_EC_EVENT};b.prototype.getClientCookieLifetime=function(){return this.CLIENT_COOKIE_LIFETIME};b.prototype.getCookieDomain=function(){return this.globalConfigProperties.COOKIE_DOMAIN||this.getDefaultCookieDomainFor(window.location.hostname)};b.prototype.getDefaultCookieDomainFor=function(c){var a=c.split("."),
e=a[a.length-1],b=a[a.length-2],b="uk"==e||"tr"==e||"br"==e||"at"==e&&"co"==b||"jp"==e&&("co"==b||"ac"==b||"go"==b||"ne"==b||"or"==b)?3:2;if(isNaN(parseInt(e,10))&&a.length>=b){c="";for(e=a.length-b;e<a.length;e++)c+="."+a[e]}return c};b.prototype.doNotTrack=function(){return window.emosDoNotTrack||this.DO_NOT_TRACK||this.COOKIE_DNT&&"1"===f.getValue(this.COOKIE_DNT)?!0:!1};b.prototype.isTrackThirdParty=function(){return"undefined"==typeof this.TRACK_THIRD_PARTY||!0==this.TRACK_THIRD_PARTY};b.prototype.isSyncCacheId=
function(){return!0==this.JSID};d.EmosConfig=b})(econda||(econda={}));
(function(b){var d=b.tracking||(b.tracking={}),f=b.tracking.EmosConfig,c=function(){};c.registerPlugin=function(a){-1===c._plugins.indexOf(a)&&c._plugins.push(a)};c.unregisterPlugin=function(a){"function"===typeof a?this.removeAllPlugInsOfType(a):this.removePlugInByInstance(a)};c.removeAllPlugInsOfType=function(a){for(var e=0;e<this._plugins.length;e++)this._plugins[e]instanceof a&&this._plugins.splice(e--,1)};c.removePlugInByInstance=function(a){for(var e=0;e<this._plugins.length;e++)this._plugins[e]===
a&&this._plugins.splice(e,1)};c.clearAll=function(){c._plugins=[]};c.getRegisteredPlugins=function(){return c._plugins};c.handleTrackingRequestEvent=function(a,e,b){void 0===a&&(a={});void 0===b&&(b={});var d=new f(e);if("object"!=typeof b.cb||null===b.cb)b.cb=[];b.cb.push(function(){c.handleTrackingAfterRequestCallback(a,d,b)});for(e=0;e<c._plugins.length;e++){var h=c._plugins[e];if("function"===typeof h.onRequest)h.onRequest(a,d,b)}};c.handleTrackingAfterRequestCallback=function(a,e,b){void 0===
a&&(a={});void 0===b&&(b={});for(var d=0;d<c._plugins.length;d++){var f=c._plugins[d];if("function"===typeof f.onAfterRequest)f.onAfterRequest(a,e,b)}};c.registerManager=function(){var a=window.emos3;if("object"!==typeof a||null===a)a=window.emos3={};if("object"!==typeof a.plugins||null===a.plugins)a.plugins=[];for(var e=0;e<a.plugins.length;e++)if(a.plugins[e]===c.handleTrackingRequestEvent)return;a.plugins.push(c.handleTrackingRequestEvent)};c._plugins=[];d.PluginManager=c;b.tracking.PluginManager.registerManager()})(econda||
(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.history||(d.history={}),f=b.tracking.PluginManager,c=function(){};c.getInstance=function(){null===c._instance&&(c._instance=new c);return c._instance};c.prototype.onRequest=function(a,e){for(var c=this.createEventsFromTrackingData(a,e.getPidIndex()),d=0;d<c.length;d++)b.data.visitor.getHistory().add(c[d]);b.util.ArrayUtils.isArray(a.arpprops)&&this.storeArpProps(a.arpprops)};c.prototype.storeArpProps=function(a){for(var e=0;e<a.length;e++){var c=a[e];
b.data.visitor.setCustomProperty(c[0],c[1])}};c.prototype.createEventsFromTrackingData=function(a,e){var b=[];if("object"===typeof a.ec_Event)for(var c=0;c<a.ec_Event.length;c++){var d=this.createEventFromEcEventItem(a.ec_Event[c],e);d&&b.push(d)}return b};c.prototype.createEventFromEcEventItem=function(a,e){var c=function(a,e){void 0===e&&(e=null);var c=null;switch(String(a).toLowerCase()){case "view":c=new b.recengine.event.ProductViewEvent(e);break;case "c_add":c=new b.recengine.event.ProductAddToCartEvent(e);
break;case "buy":c=new b.recengine.event.ProductBuyEvent(e)}return c},d=null;"undefined"!==typeof a.type?d=c(a.type,{product:{id:a.pid||null,sku:a.sku||null}}):"undefined"!==typeof a[1]&&(d=c(a[0],{product:{id:a[e],sku:null}}));return d};c.enable=function(){f.registerPlugin(c.getInstance())};c.disable=function(){f.unregisterPlugin(c.getInstance())};c._instance=null;d.TrackingListener=c;("undefined"===typeof econdaConfig.crosssellTrackEvents||!0==econdaConfig.crosssellTrackEvents)&&c.enable()})(econda||
(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.history||(d.history={}),f=b.collection.List,b=function(){var c=null!==f&&f.apply(this,arguments)||this;c._maxLength=30;return c};__extends(b,f);b.prototype.getMaxLength=function(){return this._maxLength};b.prototype.setMaxLength=function(c){this._maxLength=+c};b.prototype.cleanup=function(){this.sort("timestamp");this._items.length>this._maxLength&&this._items.splice(0,this._items.length-this._maxLength)};b.prototype.getObjectData=function(){return{className:"econda.recengine.history.VisitorHistory",
data:{items:this._items}}};b.prototype.setObjectData=function(c){"object"===typeof c&&null!==c&&"undefined"!==typeof c.items&&(this._items=c.items)};b.prototype._collectionChanged=function(){this.cleanup()};d.VisitorHistory=b})(econda||(econda={}));
(function(b){var b=b.env||(b.env={}),d=function(){};d.prototype.isAvailable=function(){if("undefined"!=typeof this.storage()&&"function"==typeof this.storage().getItem){try{this.storage().setItem("isAvailableTest","someValue"),this.storage().removeItem("isAvailableTest")}catch(b){if(b.message&&-1<b.message.toLowerCase().indexOf("quota"))return!1}return!0}return!1};d.prototype.setItem=function(b,c){this.isAvailable()&&this.storage().setItem(b,c)};d.prototype.getItem=function(b){return this.isAvailable()?
this.storage().getItem(b):null};d.prototype.removeItem=function(b){this.isAvailable()&&this.storage().removeItem(b)};b.AbstractStorage=d})(econda||(econda={}));
(function(b){var d=b.env||(b.env={}),f=b.env.AbstractStorage,c=function(){return null!==f&&f.apply(this,arguments)||this};__extends(c,f);c.prototype.storage=function(){return window.sessionStorage};c.isAvailable=function(){return(new c).isAvailable()};c.setItem=function(a,e){(new c).setItem(a,e)};c.getItem=function(a){return(new c).getItem(a)};c.removeItem=function(a){(new c).removeItem(a)};d.SessionStorage=c})(econda||(econda={}));
(function(b){(function(b){var f=function(){function b(){}b.stringify=function(a){b.stringify="undefined"!=typeof JSON&&JSON.stringify?JSON.stringify:b._stringify;return b.stringify(a)};b._stringify=function(a){var e=typeof a,b,c=[],d=a&&a.constructor==Array;if("object"!=e||null===a)return"string"==e&&(a='"'+a+'"'),String(a);for(var f in a)b=a[f],e=typeof b,"string"==e?b='"'+b+'"':"object"==e&&null!==b&&(b=this.stringify(b)),c.push((d?"":'"'+f+'":')+String(b));return(d?"[":"{")+String(c)+(d?"]":"}")};
b.parse=function(a){b.parse="undefined"!=typeof JSON&&JSON.parse?JSON.parse:b._parse;return b.parse(a)};b._parse=function(a){var e=b.cx,a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+a+")");throw new SyntaxError("JSON.parse");
};b.cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;return b}();b.Json=f})(b.util||(b.util={}))})(econda||(econda={}));
(function(b){(function(d){var f=function(){function c(){}c.serialize=function(a){return(new c).serialize(a)};c.deserialize=function(a,e){void 0===e&&(e=null);return(new c).deserialize(a,e)};c.prototype.serialize=function(a){a=this._serializeNestedObjects(a);return b.util.Json.stringify(a)};c.prototype._serializeNestedObjects=function(a){var e;if(b.util.ArrayUtils.isArray(a)){e=[];for(var c=0;c<a.length;c++)e[c]=this._serializeNestedObjects(a[c]);return e}if("object"===typeof a&&null!==a){if("undefined"!==
typeof a.getObjectData)e=a.getObjectData(),e["$serialized-object$"]=!0,e.data=this._serializeNestedObjects(e.data||null);else if(a instanceof Date)e={className:"Date","$serialized-object$":!0,data:a.toISOString()};else for(c in e={},a)e[c]=this._serializeNestedObjects(a[c]);return e}return a};c.prototype.deserialize=function(a,e){void 0===e&&(e=null);if(!a)return e||null;var c=b.util.Json.parse(a);null!==e?(this._applyData(c.data,e),c=e):c=this._resolveNestedSerializedObjects(c);return c};c.prototype._applyData=
function(a,e){if("function"!==typeof e.setObjectData)throw"setObjectData() not implemented. Cannot deserialize object";a=this._resolveNestedSerializedObjects(a);e.setObjectData(a)};c.prototype._resolveNestedSerializedObjects=function(a){if(b.util.ArrayUtils.isArray(a))for(var e=0;e<a.length;e++)a[e]=this._resolveNestedSerializedObjects(a[e]);else if("object"===typeof a&&null!==a)if("undefined"!==typeof a["$serialized-object$"])a=this._deserializeNestedObject(a);else for(e in a)a[e]=this._resolveNestedSerializedObjects(a[e]);
return a};c.prototype._deserializeNestedObject=function(a){var e;if("Date"===a.className)e=new Date(a.data);else try{e=eval("new "+a.className+"();"),"undefined"!==typeof a.data&&this._applyData(a.data,e)}catch(c){b.debug.error("deserialization faild with exception:",c)}return e};return c}();d.JsonSerializer=f})(b.serialization||(b.serialization={}))})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.visitor||(d.visitor={}),f=b.env.SessionStorage,c=b.base.BaseClass,a=function(e){var b=c.call(this)||this;b._ids={};b._properties={};b._loginState=null;b._history=null;b._isInTransaction=!1;b._triggerSaveTimeout=null;if(e instanceof a)return e;b.initConfig(e);return b};__extends(a,c);a.prototype.setId=function(a,b){void 0===b&&(b=null);if("string"===typeof a)this._ids[a]=b;else for(var c in a)this._ids[c]=a[c];this._triggerSaveIfNotInTransaction();
return this};a.prototype.setIds=function(a,b){void 0===b&&(b=null);this.setId(a,b)};a.prototype.getId=function(a){return this._ids[a]||null};a.prototype.getIds=function(){return this._ids};a.prototype.clearIds=function(){this._ids={};this._triggerSaveIfNotInTransaction()};a.prototype.getProperty=function(a){return this._properties[a]||null};a.prototype.setProperty=function(a,b){if("string"===typeof a)this._properties[a]=b;else if("object"===typeof a&&null!==a)for(var c in a)this._properties[c]=a[c];
this._triggerSaveIfNotInTransaction()};a.prototype.getProperties=function(a){return"string"===typeof a?this._properties[a]||null:this._properties};a.prototype.setProperties=function(a,b){void 0===b&&(b=null);this.setProperty(a,b)};a.prototype.clearProperties=function(){this._properties={};this._triggerSaveIfNotInTransaction()};a.prototype.setLoginState=function(a){this._loginState=a;this._triggerSaveIfNotInTransaction()};a.prototype.getLoginState=function(){return this._loginState};a.prototype.getHistory=
function(){return this._history};a.prototype.setHistory=function(a){var b=this;this._history=a;this._triggerSaveIfNotInTransaction();null!==this._history&&this._history.setOnChange(function(){return b._triggerSaveIfNotInTransaction()})};a.prototype.beginTransaction=function(){this._isInTransaction=!0};a.prototype.commitTransaction=function(){this._isInTransaction=!1;this.saveInBrowser()};a.prototype._triggerSaveIfNotInTransaction=function(){this._isInTransaction||this._triggerSaveInBrowser()};a.prototype._triggerSaveInBrowser=
function(){var a=this;null!==this._triggerSaveTimeout&&clearTimeout(this._triggerSaveTimeout);this._triggerSaveTimeout=setTimeout(function(){a.saveInBrowser()},50)};a.prototype.saveInBrowser=function(){null!==this._triggerSaveTimeout&&clearTimeout(this._triggerSaveTimeout);var c=new b.serialization.JsonSerializer;f.setItem(a.STORAGE_KEY,c.serialize(this))};a.prototype.loadFromBrowser=function(){null!==this._triggerSaveTimeout&&clearTimeout(this._triggerSaveTimeout);var c=new b.serialization.JsonSerializer,
g=f.getItem(a.STORAGE_KEY);g&&c.deserialize(g,this)};a.prototype.getObjectData=function(){return{className:"econda.recengine.visitor.VisitorData",data:{ids:this._ids,properties:this._properties,loginState:this._loginState,history:this._history}}};a.prototype.setObjectData=function(a){"object"===typeof a&&null!==a&&("object"===typeof a.properties&&null!==a.properties&&(this._properties=a.properties),"object"===typeof a.ids&&null!==a.ids&&(this._ids=a.ids),"undefined"!==typeof a.loginState&&(this._loginState=
a.loginState),"undefined"!==typeof a.history&&this.setHistory(a.history))};a.STORAGE_KEY="econda.recengine.VisitorData";d.VisitorData=a})(econda||(econda={}));
(function(b){var d=b.tracking||(b.tracking={}),f=b.cookie.Store,c=b.util.StringUtils,a=function(){};a.get=function(){var a=f.getValue("emos_jcvid");return null!==a?a.split(":",2)[0]:null};a.update=function(a,g){void 0===g&&(g={});var d=function(a,b){for(var c in g)if(!1==b||"expires"!=c)a[c]=g[c];return a};if("string"!==typeof a)b.debug.error("Invalid visitor id given in VisitorId::update().");else{var a=c.trim(a),h=window.emos3;"object"===typeof h&&(h.emos_vid=a);h=f.getValue("emos_jcvid");h="string"===
typeof h&&-1!==h.indexOf(":")?a+h.substring(h.indexOf(":")):a;f.set(d({name:"emos_jcvid",value:h},!1),!1)}};d.VisitorId=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),f=b.recengine.history.VisitorHistory,c=b.recengine.visitor.VisitorData,a=b.util.ArrayUtils,e=b.tracking.VisitorId,g=b.env.SessionStorage,j=b.base.BaseClass,h=function(a){void 0===a&&(a=null);var b=j.call(this)||this;b._persistentData=null;b.initConfig(a);b._initPersistentData();null===g.getItem("econda.recengine.VisitorProfile.initialized")&&b._onFirstInitOfSession();g.setItem("econda.recengine.VisitorProfile.initialized",(new Date).toString());b._initRecipientId();
return b};__extends(h,j);h.prototype.beginTransaction=function(){this._persistentData.beginTransaction()};h.prototype.commitTransaction=function(){this._persistentData.commitTransaction()};h.prototype.getVisitorId=function(){return e.get()};h.prototype.getRecipientId=function(){return this._persistentData.getId("recipientId")};h.prototype.setRecipientId=function(a){this._persistentData.setId("recipientId",a)};h.prototype.getCustomerId=function(){return this._persistentData.getId("customerId")};h.prototype.setCustomerId=
function(a){this._persistentData.setId("customerId",a)};h.prototype.getUserId=function(){return this._persistentData.getId("userId")};h.prototype.setUserId=function(a){this._persistentData.setId("userId",a)};h.prototype.getEmail=function(){return this._persistentData.getId("email")};h.prototype.setEmail=function(a){this._persistentData.setId("email",a)};h.prototype.getEmailHash=function(){return this._persistentData.getId("emailHash")};h.prototype.setEmailHash=function(a){this._persistentData.setId("emailHash",
a)};h.prototype.hasIds=function(){if(this.getVisitorId())return!0;var a=this._persistentData.getIds();return a&&0<Object.keys(a).length?!0:!1};h.prototype.getIds=function(){return this._persistentData.getIds()};h.prototype.getLoginState=function(){return this._persistentData.getLoginState()||h.LOGIN_STATE_UNKNOWN};h.prototype.setLoginState=function(c){a.contains([h.LOGIN_STATE_PREVIOUS_SESSION,h.LOGIN_STATE_SIGNED_IN,h.LOGIN_STATE_SIGNED_OUT,h.LOGIN_STATE_UNKNOWN],c)||b.debug.error("Invalid login state: "+
c);this._persistentData.setLoginState(c)};h.prototype.login=function(a){void 0===a&&(a=null);this._persistentData.setLoginState(h.LOGIN_STATE_SIGNED_IN);a=a||{};"object"===typeof a.ids&&null!==a.ids&&this._persistentData.setIds({customerId:a.ids.customerId||null,userId:a.ids.userId||null,email:a.ids.email||null,emailHash:a.ids.emailHash||null});this._persistentData.clearProperties();"object"===typeof a.properties&&null!==a.properties&&this.setProperties(a.properties);return this};h.prototype.logout=
function(){this._persistentData.setLoginState(h.LOGIN_STATE_SIGNED_OUT);this.clearAll();return this};h.prototype.clearAll=function(){this._persistentData.clearIds();this._persistentData.clearProperties();return this};h.prototype.getProperties=function(){return this._persistentData.getProperties()};h.prototype.setProperties=function(a){this._persistentData.setProperties(a)};h.prototype.setProperty=function(a,b){this._persistentData.setProperty(a,b)};h.prototype.getProperty=function(a){return this._persistentData.getProperty(a)};
h.prototype.setCustomProperty=function(a,b){this.setProperty(h.CUSTOM_PROFILE_PROPERTIES_PREFIX+a,b)};h.prototype.getCustomProperty=function(a){return this.getProperty(h.CUSTOM_PROFILE_PROPERTIES_PREFIX+a)};h.prototype.getVisitorHistory=function(){return this.getHistory()};h.prototype.getHistory=function(){return this._persistentData.getHistory()};h.prototype._onFirstInitOfSession=function(){this.setRecipientId(null);this.getLoginState()===h.LOGIN_STATE_SIGNED_IN&&this.setLoginState(h.LOGIN_STATE_PREVIOUS_SESSION);
return this};h.prototype._initRecipientId=function(){var a=(new b.net.Uri(window.location.href)).getParam("ecmUid");a&&this.setRecipientId(a);return this};h.prototype._initPersistentData=function(){this._persistentData=new c;this._persistentData.loadFromBrowser();!1===this.getHistory()instanceof f&&this._persistentData.setHistory(new f);return this};h.CUSTOM_PROFILE_PROPERTIES_PREFIX="cu:";h.LOGIN_STATE_SIGNED_IN="signed_in";h.LOGIN_STATE_PREVIOUS_SESSION="previous_session";h.LOGIN_STATE_SIGNED_OUT=
"signed_out";h.LOGIN_STATE_UNKNOWN="unknown";d.VisitorProfile=h})(econda||(econda={}));
(function(b){var d=b.storage||(b.storage={}),f=b.base.BaseClass,c=function(a){var b=f.call(this)||this;b._name=null;b._value=null;b._permanent=!1;b._pageViewsToLive=null;b._expires=null;b._invalidationAction=c.INVALIDATION_ACTION_REMOVE;b._isValid=!0;if(a instanceof c)return a;b.initConfig(a);return b};__extends(c,f);c.prototype.setName=function(a){this._name=a;return this};c.prototype.getName=function(){return this._name};c.prototype.setValue=function(a){this._value=a;return this};c.prototype.getValue=
function(){return this._value};c.prototype.setPermanent=function(a){this._permanent=a;return this};c.prototype.getPermanent=function(){return this._permanent};c.prototype.setPageViewsToLive=function(a){this._pageViewsToLive=a;return this};c.prototype.getPageViewsToLive=function(){return this._pageViewsToLive};c.prototype.setExpires=function(a){this._expires=a;return this};c.prototype.getExpires=function(){return this._expires};c.prototype.setTtl=function(a){var b=new Date;b.setSeconds(b.getSeconds()+
a);this._expires=b;return this};c.prototype.setInvalidationAction=function(a){this._invalidationAction=a;return this};c.prototype.getInvalidationAction=function(){return this._invalidationAction};c.prototype.getIsValid=function(){return this._isValid};c.prototype._setIsValid=function(a){this._isValid=a;return this};c.prototype.getObjectData=function(){return{className:"econda.storage.Variable",data:{name:this._name,value:this._value,expires:this._expires,pageViewsToLive:this._pageViewsToLive,permanent:this._permanent,
invalidationAction:this._invalidationAction}}};c.prototype.setObjectData=function(a){this.set(a)};c.INVALIDATION_ACTION_REMOVE="remove";c.INVALIDATION_ACTION_KEEP="keep";d.Variable=c})(econda||(econda={}));
(function(b){var d=b.env||(b.env={}),f=b.env.AbstractStorage,c=function(){return null!==f&&f.apply(this,arguments)||this};__extends(c,f);c.prototype.storage=function(){return window.localStorage};c.isAvailable=function(){return(new c).isAvailable()};c.setItem=function(a,b){(new c).setItem(a,b)};c.getItem=function(a){return(new c).getItem(a)};c.removeItem=function(a){(new c).removeItem(a)};d.LocalStorage=c})(econda||(econda={}));
(function(b){var d=b.storage||(b.storage={}),f=b.storage.Variable,c=b.env.SessionStorage,a=b.env.LocalStorage,e=function(a){this._lastSaved=this._triggerSaveTimeout=null;this._name="default";this._autoSave=!0;this._variables={};this._variableStates={};if(a instanceof e)return a;"object"===typeof a&&null!==a&&("undefined"!==typeof a.name&&this.setName(a.name),"undefined"!==typeof a.autoSave&&this.setAutoSave(a.autoSave))};e.prototype.setName=function(a){this._name=a;return this};e.prototype.getName=
function(){return this._name};e.prototype.setAutoSave=function(a){this._autoSave=a;return this};e.prototype.getAutoSave=function(){return this._autoSave};e.prototype.getStorageKey=function(){return"econda.storage.ClientBag."+this._name};e.prototype.getAllVariables=function(){var a=[],b;for(b in this._variables)a.push(this._variables[b]);return a};e.prototype.get=function(a){return"undefined"===typeof this._variables[a]?null:this._variables[a]};e.prototype.getState=function(a){return"undefined"===
typeof this._variableStates[a]?null:this._variableStates[a]};e.prototype.set=function(a,b){void 0===b&&(b=!1);a=new f(a);if(!a.getName())throw"Cannot set variable. Name attribute is required but empty.";var c=a.getName();if(!0===b||"undefined"===typeof this._variables[c])this._variables[c]=a;this._variableStates[c]={added:new Date,pageViews:0};this._autoSave&&this._triggerSaveInBrowser();return this};e.prototype.update=function(a,b){var c=this.get(a);null!==c&&c.set(b);this._autoSave&&this._triggerSaveInBrowser();
return this};e.prototype._triggerSaveInBrowser=function(){var a=this;null!==this._triggerSaveTimeout&&clearTimeout(this._triggerSaveTimeout);this._triggerSaveTimeout=setTimeout(function(){a.saveInBrowser()},100)};e.prototype.saveInBrowser=function(){var e={state:{},variables:[]},d={state:{},variables:[]},f;for(f in this._variables){var i=this._variables[f];i.getPermanent()?(d.variables.push(i),"undefined"!==typeof this._variableStates[f]&&(d.state[f]=this._variableStates[f])):(e.variables.push(i),
"undefined"!==typeof this._variableStates[f]&&(e.state[f]=this._variableStates[f]))}f=new b.serialization.JsonSerializer;a.setItem(this.getStorageKey(),f.serialize(d));c.setItem(this.getStorageKey(),f.serialize(e));this._lastSaved=new Date;return this};e.prototype.loadFromBrowser=function(){var e,d,f=new b.serialization.JsonSerializer;d=a.getItem(this.getStorageKey());e=c.getItem(this.getStorageKey());if(d){var i=f.deserialize(d);"undefined"===typeof i.state&&(i.state={});for(d=0;d<i.variables.length;d++){var k=
i.variables[d].getName();this._variables[k]=i.variables[d];"object"===typeof i.state[k]&&null!==i.state[k]&&(this._variableStates[k]=i.state[k])}}if(e){e=f.deserialize(e);"undefined"===typeof e.state&&(e.state={});for(d=0;d<e.variables.length;d++)k=e.variables[d].getName(),this._variables[k]=e.variables[d],"object"===typeof e.state[k]&&null!==e.state[k]&&(this._variableStates[k]=e.state[k])}return this};e.prototype.init=function(){this.loadFromBrowser()._initVariablesAndState().saveInBrowser();return this};
e.prototype._initVariablesAndState=function(){for(var a in this._variables)this._updateVariableState(this._variables[a]);for(a in this._variableStates)"undefined"===typeof this._variables[a]&&delete this._variableStates[a];return this};e.prototype._updateVariableState=function(a){var b=a.getName(),c="undefined"!==typeof this._variableStates[b]?this._variableStates[b]:{added:new Date,pageViews:0};c.pageViews++;var e=!0,d=a.getPageViewsToLive(),e=e&&(null===d||c.pageViews<=d),a=a.getExpires(),e=e&&
(null===a||a>=new Date);!1===e&&this._invalidateVariable(b);return this};e.prototype._invalidateVariable=function(a){var b=this._variables[a];switch(b.getInvalidationAction()){case f.INVALIDATION_ACTION_REMOVE:this.destroy(a);break;case f.INVALIDATION_ACTION_KEEP:b._setIsValid(!1);break;default:throw"Invalid invalidation action.";}return this};e.prototype.destroy=function(a){delete this._variables[a];delete this._variableStates[a];return this};d.ClientBag=e})(econda||(econda={}));
(function(b){var d=b.env||(b.env={}),f=b.net.Uri,c=b.base.BaseClass,a=function(b){var d=c.call(this)||this;d._uri=null;d._timestamp=null;d._viewTime=null;if(b instanceof a)return b;d.initConfig(b);return d};__extends(a,c);a.prototype.getUri=function(){return this._uri};a.prototype.setUri=function(a){this._uri=new f(a);return this};a.prototype.getTimestamp=function(){return this._timestamp};a.prototype.setTimestamp=function(a){this._timestamp=a;return this};a.prototype.getViewTime=function(){return this._viewTime};
a.prototype.setViewTime=function(a){this._viewTime=a;return this};a.prototype.getObjectData=function(){return{className:"econda.env.PageView",data:{uri:this._uri?this._uri.toString():null,timestamp:this._timestamp,viewTime:this._viewTime}}};a.prototype.setObjectData=function(a){"object"===typeof a&&null!==a&&(this._uri=a.uri||null,this._timestamp=a.timestamp||null,this._viewTime=a.viewTime||null)};d.PageView=a})(econda||(econda={}));
(function(b){var d=b.env||(b.env={}),f=b.serialization.JsonSerializer,c=b.base.BaseClass,a=function(b){var d=c.call(this)||this;d._startDate=null;d._history=[];if(b instanceof a)return b;d.initConfig(b);return d};__extends(a,c);a.isSupported=function(){if("undefined"===typeof window.sessionStorage)return!1;var a=null;try{window.sessionStorage.setItem("ectest","ok"),a=window.sessionStorage.getItem("ectest")}finally{return"ok"==a}};a.prototype.getStartDate=function(){return this._startDate};a.prototype.getPageViewCount=
function(){return this.getHistory().length};a.prototype.getHistory=function(){return this._history};a.prototype.getObjectData=function(){return{className:"econda.env.Session",data:{startDate:this._startDate,history:this._history}}};a.prototype.setObjectData=function(a){this._startDate=a.startDate||null;this._history=a.history||[]};a.prototype.init=function(){this._loadFromSessionStorage();null===this._startDate&&this._initNewSession();this._addCurrentPageView();this._saveToSessionStorage()};a.prototype._initNewSession=
function(){this._startDate=new Date};a.prototype._loadFromSessionStorage=function(){var a=window.sessionStorage.getItem("econda.env.Session");return a?(f.deserialize(a,this),!0):!1};a.prototype._saveToSessionStorage=function(){window.sessionStorage.setItem("econda.env.Session",f.serialize(this))};a.prototype._addCurrentPageView=function(){var a=new b.env.PageView({timestamp:new Date,uri:document.location.href});this._history.push(a);return this};d.Session=a})(econda||(econda={}));
(function(b){var d=function(){};d.visitor=null;d.session=null;d.clientBag=null;b.data=d})(econda||(econda={}));econda.data.visitor=new econda.recengine.VisitorProfile;"object"===typeof econdaConfig&&("undefined"!==typeof econdaConfig.sessionStart&&econdaConfig.sessionStart&&econda.env.Session.isSupported())&&(econda.data.session=new econda.env.Session,econda.data.session.init());
"object"===typeof econdaConfig&&("undefined"!==typeof econdaConfig.clientBag&&!0===econdaConfig.clientBag)&&(econda.data.clientBag=(new econda.storage.ClientBag).init());
(function(b){var d=b.recengine||(b.recengine={}),d=d.context||(d.context={}),f=b.base.BaseClass,b=function(b){void 0===b&&(b=null);var a=f.call(this)||this;a.type="productcategory";a.id=null;a.variant=null;a.path=null;a.initConfig(b);return a};__extends(b,f);b.prototype.getType=function(){return this.type};b.prototype.setType=function(b){this.type=b;return this};b.prototype.getId=function(){return this.id};b.prototype.setId=function(b){this.id=b;return this};b.prototype.getVariant=function(){return this.variant};
b.prototype.setVariant=function(b){this.variant=b;return this};b.prototype.getPath=function(){return this.path};b.prototype.setPath=function(b){"string"==typeof b&&(b={path:b,delimiter:"/"});"object"==typeof b&&"undefined"!=typeof b.path&&("undefined"==typeof b.delimiter&&(b.delimiter="/"),b=b.path.split(b.delimiter));this.path=b;return this};d.CategoryReference=b})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.context||(d.context={}),f=b.recengine.context.CategoryReference,c=b.recengine.context.ProductReference,a=b.recengine.history.VisitorHistory,e=b.base.BaseClass,g=function(a){var b=e.call(this)||this;b.products=[];b.visitorHistory=null;b.categories=[];b.attributes={};b.profileProperties={};b.visitorId=null;b.customerId=null;b.recipientId=null;b.userId=null;b.email=null;b.emailHash=null;b.productsExcluded=[];b._appendVisitorData=null;a=a||{};if(a instanceof
g)return a;"undefined"!=typeof a.appendVisitorData&&(b._appendVisitorData=!0===a.appendVisitorData,delete a.appendVisitorData);b.initConfig(a);(!0===b._appendVisitorData||null===b._appendVisitorData&&("undefined"===typeof econdaConfig.crosssellAppendVisitorData||!0===econdaConfig.crosssellAppendVisitorData))&&b._doAppendVisitorData();return b};__extends(g,e);g.prototype.getProducts=function(){return this.products};g.prototype.setProducts=function(a){this.products=[];this.addProducts(a);return this};
g.prototype.addProducts=function(a){return this.addArray("products",a,c,{itemFilter:this._productReferenceInputFilter})};g.prototype.addProduct=function(a){return this.addProducts(a)};g.prototype.getVisitorHistory=function(){return this.visitorHistory};g.prototype.setVisitorHistory=function(b){this.visitorHistory=new a(b)};g.prototype.getCategories=function(){return this.categories};g.prototype.setCategories=function(a){return this.setArray("categories",a,f)};g.prototype.addCategories=function(a){return this.addArray("categories",
a,f)};g.prototype.addCategory=function(a){return this.addCategories(a)};g.prototype.getAttributes=function(){return this.attributes};g.prototype.setAttributes=function(a,b){void 0===b&&(b=null);this.attributes={};return this.addAttributes(a,b)};g.prototype.addAttributes=function(a,b){void 0===b&&(b=null);if("string"==typeof a)this.attributes[a]=b;else for(var c in a)this.attributes[c]=a[c];return this};g.prototype.setProfileProperties=function(a){this.profileProperties=a};g.prototype.getProfileProperties=
function(){return this.profileProperties};g.prototype.setVisitorId=function(a){this.visitorId=a;return this};g.prototype.getVisitorId=function(){return this.visitorId};g.prototype.setCustomerId=function(a){this.customerId=a;return this};g.prototype.getCustomerId=function(){return this.customerId};g.prototype.setRecipientId=function(a){this.recipientId=a;return this};g.prototype.getRecipientId=function(){return this.recipientId};g.prototype.setUserId=function(a){this.userId=a;return this};g.prototype.getUserId=
function(){return this.userId};g.prototype.setEmail=function(a){this.email=a;return this};g.prototype.getEmail=function(){return this.email};g.prototype.setEmailHash=function(a){this.emailHash=a;return this};g.prototype.getEmailHash=function(){return this.emailHash};g.prototype.getProductsExcluded=function(){return this.productsExcluded};g.prototype.setProductsExcluded=function(a){return this.setArray("productsExcluded",a,c,{itemFilter:this._productReferenceInputFilter})};g.prototype.addProductsExcluded=
function(a){return this.addArray("productsExcluded",a,c,{itemFilter:this._productReferenceInputFilter})};g.prototype._productReferenceInputFilter=function(a){return a instanceof c?a:{id:a.id||null,sku:a.sku||null}};g.prototype._doAppendVisitorData=function(){try{var a=b.data.visitor;this.setVisitorId(a.getVisitorId());this.setCustomerId(a.getCustomerId());this.setUserId(a.getUserId());this.setRecipientId(a.getRecipientId());this.setEmail(a.getEmail());this.setEmailHash(a.getEmailHash());this.setProfileProperties(a.getProperties());
this.setVisitorHistory(a.getHistory())}catch(c){b.debug.error("Could not append visitor profile data to cross sell request due to an internal exception: "+c)}};d.Context=g})(econda||(econda={}));
(function(b){var b=b.util||(b.util={}),d=function(){};d.isDate=function(b){return"[object Date]"==Object.prototype.toString.call(b)};d.toUtcIsoString=function(b){function c(a){return 10>a?"0"+a:""+a}return b instanceof Date?b.getUTCFullYear()+"-"+c(b.getUTCMonth()+1)+"-"+c(b.getUTCDate())+"T"+c(b.getUTCHours())+":"+c(b.getUTCMinutes())+":"+c(b.getUTCSeconds())+"Z":null};b.DateUtils=d})(econda||(econda={}));
(function(b){var b=b.env||(b.env={}),d=function(){};d.getUserAgent=function(){null==this.userAgent&&(this.userAgent=window.navigator.userAgent);return this.userAgent};d.getName=function(){null==this._name&&this.init();return this._name};d.getVersion=function(){null==this._version&&this.init();return this._version};d.isMobile=function(){null==this._isMobile&&this.init();return this._isMobile};d.init=function(){this.initNameAndVersion();this.initIsMobile()};d.initIsMobile=function(){this._isMobile=
null!=navigator.userAgent.match(/mobile/i)};d.initNameAndVersion=function(){var b=this.getUserAgent();null==this._name&&/;\s*MSIE\s+(\d+\.\d+)*/.test(b)&&(this._name=this.INTERNET_EXPLORER,this._version=+RegExp.$1);null==this._name&&/Firefox\s*\/\s*(\d+\.\d+)*/.test(b)&&(this._name=this.FIREFOX,this._version=+RegExp.$1);null==this._name&&/Chrome\s*\/\s*(\d+\.\d+)*/.test(b)&&(this._name=this.CHROME,this._version=+RegExp.$1);null==this._name&&/Version\s*\/\s*(\d+\.\d+)*.*Safari/.test(b)&&(this._name=
this.SAFARI,this._version=+RegExp.$1)};d.INTERNET_EXPLORER="internet explorer";d.CHROME="chrome";d.FIREFOX="firefox";d.SAFARI="safari";d.userAgent=null;d._name=null;d._version=null;d._isMobile=null;b.UserAgent=d})(econda||(econda={}));(function(b){(b.ajax||(b.ajax={})).Response=function(){this.isError=this.responseText=this.status=null}})(econda||(econda={}));
(function(b){var d=b.ajax||(b.ajax={}),d=d.writer||(d.writer={}),f=b.base.BaseClass,c=function(){var a=null!==f&&f.apply(this,arguments)||this;a._data=null;return a};__extends(c,f);c.prototype.setData=function(a){this._data=a;return this};c.prototype.getHeaders=function(){return{"Content-Type":"application/json; charset=UTF-8"}};c.prototype.getBody=function(){return b.util.Json.stringify(this._data)};d.JsonWriter=c})(econda||(econda={}));
(function(b){var d=b.ajax||(b.ajax={}),d=d.writer||(d.writer={}),f=b.base.BaseClass,c=function(){var a=null!==f&&f.apply(this,arguments)||this;a._data=null;return a};__extends(c,f);c.prototype.setData=function(a){this._data=a;return this};c.prototype.getHeaders=function(){return{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};c.prototype.getBody=function(){var a=[],c=this._data,d;for(d in c)if(b.util.ArrayUtils.isArray(c[d]))for(var f=0;f<c[d].length;f++)a.push(d+"="+encodeURIComponent(c[d][f]));
else a.push(d+"="+encodeURIComponent(c[d]));return a.join("&")};d.FormEncodedWriter=c})(econda||(econda={}));(function(b){var d=b.ajax||(b.ajax={}),d=d.reader||(d.reader={}),f=function(){};f.prototype.read=function(c){var a=null;if(c)try{a=b.util.Json.parse(c)}catch(e){a=null}return a};d.JsonReader=f})(econda||(econda={}));
(function(b){var d=b.ajax||(b.ajax={}),d=d.transport||(d.transport={}),f=b.ajax.Response,c=function(){this._initialized=!1;this._allHeaders={}};c.prototype.setRequest=function(a){this._request=a};c.prototype.getRequest=function(){return this._request};c.prototype.hasHeaders=function(){if(Object.keys)return 0<Object.keys(this._allHeaders).length;var a=[],b;for(b in this._allHeaders)Object.prototype.hasOwnProperty.call(this._allHeaders,b)&&a.push(b);return 0<a.length};c.prototype.init=function(){this.initWriterInstance();
this.initXmlHttpRequestInstance();this.appendCallbacks();this._xhr.open("POST",this.getRequestUriWithParams(),!0);this._xhr.timeout=this._request.getTimeoutMilliseconds();this._request.isXDomainRequest()&&(this._request.getWithCredentials()&&this._xhr instanceof XMLHttpRequest)&&(this._xhr.withCredentials=!0);this.appendHeaders();this._initialized=!0};c.prototype.send=function(){var a=this;this._initialized||this.init();setTimeout(function(){a._xhr.send(a.getEncodedRequestData());var b=a._request.getAfterSend();
b&&b()},20)};c.prototype.initWriterInstance=function(){var a=this._request.getData(),c=this._request.getWriter();null==c&&a&&"object"==typeof a&&(c=new b.ajax.writer.FormEncodedWriter);c&&(c.setData(this._request.getData()),this._writer=c)};c.prototype.appendHeaders=function(){var a={"Content-Type":"text/plain"};!1==this._request.isXDomainRequest()&&(a["X-Requested-With"]="XMLHttpRequest");if(this._writer){var b=this._writer.getHeaders();if(b)for(var c in b)a[c]=b[c]}if(b=this._request.getHeaders())for(c in b)a[c]=
b[c];this._allHeaders=a;if("undefined"!=typeof this._xhr.setRequestHeader)for(c in a)this._xhr.setRequestHeader(c,a[c]);return this};c.prototype.getEncodedRequestData=function(){var a="";return a=this._writer?this._writer.getBody():""+this._request.getData()};c.prototype.isSupportedRequest=function(){this.initXmlHttpRequestInstance();var a=this._request.isXDomainRequest();return a=(a=(a=!1==a||!1==this._isOldIE())&&!1==this.hasHeaders()||"undefined"!=typeof this._xhr.setRequestHeader&&!1==this._isOldIE())&&
(!1==this._request.getWithCredentials()||this._xhr instanceof XMLHttpRequest)};c.prototype._isOldIE=function(){var a=b.env.UserAgent;return a.getName()!=a.INTERNET_EXPLORER||8<=a.getVersion()?!1:!0};c.prototype.initXmlHttpRequestInstance=function(){var a=this._request.isXDomainRequest();this._xhr||(this._xhr=a&&"undefined"!=typeof window.XDomainRequest?new window.XDomainRequest:"undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))};c.prototype.getRequestUriWithParams=
function(){var a=this._request.getUri(),b=this._request.getParams();return a.clone().appendParams(b).toString()};c.prototype.appendCallbacks=function(){var a=this;this._xhr.onreadystatechange=function(){a.onReadyStateChange.apply(a,arguments)};return this};c.prototype.onReadyStateChange=function(){var a=this._xhr,b=this._request;if(4==a.readyState){var c=new f;c.responseText=a.responseText;c.status=a.status;c.isError=200!=a.status;b.handleResponse(c)}};d.Post=c})(econda||(econda={}));
(function(b){var d=b.ajax||(b.ajax={}),d=d.transport||(d.transport={}),f=b.ajax.Response,b=function(){this._initialized=!1;this._allHeaders={}};b.prototype.setRequest=function(b){this._request=b};b.prototype.getRequest=function(){return this._request};b.prototype.isSupportedRequest=function(){return!0};b.prototype.hasHeaders=function(){if(Object.keys)return 0<Object.keys(this._allHeaders).length;var b=[],a;for(a in this._allHeaders)Object.prototype.hasOwnProperty.call(this._allHeaders,a)&&b.push(a);
return 0<b.length};b.prototype.init=function(){var b=this;this._xhr=this.createXmlHttpRequestInstance();this._xhr.onreadystatechange=function(){b.onReadyStateChange.apply(b,arguments)};this._xhr.open("GET",this.getRequestUriWithParams(),!0);this.appendHeaders();this._initialized=!0};b.prototype.appendHeaders=function(){var b={"Content-Type":"text/plain"};!1==this._request.isXDomainRequest()&&(b["X-Requested-With"]="XMLHttpRequest");var a=this._request.getHeaders();if(a)for(var e in a)b[e]=a[e];this._allHeaders=
b;if("undefined"!=typeof this._xhr.setRequestHeader)for(e in b)this._xhr.setRequestHeader(e,b[e]);return this};b.prototype.send=function(b){var a=this;"undefined"!=typeof b&&this.setRequest(b);this._initialized||this.init();setTimeout(function(){a._xhr.send()},20)};b.prototype.createXmlHttpRequestInstance=function(){var b=null;return b="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")};b.prototype.getRequestUriWithParams=function(){var b=this._request.getUri(),
a=this._request.getParams();return b.clone().appendParams(a).toString()};b.prototype.onReadyStateChange=function(){var b=this._xhr,a=this._request;if(4==b.readyState){var e=new f;e.responseText=b.responseText;e.status=b.status;e.isError=200!=b.status;a.handleResponse(e)}};d.Get=b})(econda||(econda={}));
(function(b){var d=b.ajax||(b.ajax={}),d=d.transport||(d.transport={}),f=b.ajax.Response,c=b.net.Uri,a=function(){this._instanceIndex=this._request=this._iframe=null;this._state=0;this._instanceIndex=a._instanceCount++};a.setBlankUri=function(a){econdaConfig.blankUri=new c(a)};a.getBlankUri=function(){if("undefined"!=typeof econdaConfig){var b=econdaConfig;if("undefined"!=typeof b.blankUri)return new c(b.blankUri)}return new c(a.defaultBlankUri)};a.prototype.setRequest=function(a){this._request=a};
a.prototype.init=function(){};a.prototype.send=function(){var a=this._request.getUri(),a=a.appendParams({windowname:"true"}),a=a.appendParams(this._request.getParams());this.setupIFrame();b.debug.log("Sending request using window.name transport to uri: "+a);this.navigateIFrameToTarget(a)};a.prototype.isSupportedRequest=function(){return!0};a.prototype.navigateIFrameToTarget=function(b){this._iframe.contentWindow.location.href=b.toString();this._state=a.STATE_LOADING};a.prototype.navigateIFrameToOwnHost=
function(){this._iframe.contentWindow.location.href=a.getBlankUri().toString()};a.prototype.handleOnLoad=function(){switch(this._state){case a.STATE_LOADING:this._state=a.STATE_LOADED;this.navigateIFrameToOwnHost();break;case a.STATE_LOADED:var c=new f;try{c.responseText=this._iframe.contentWindow.name,c.status=200,c.isError=!1}catch(d){b.debug.error("Could not read content from iframe for request to "+this._request.getUri().toString(),{exception:d,iframe:this._iframe}),c.responseText="",c.status=
0,c.isError=!0}this._request.handleResponse(c);this.removeIFrame()}};a.prototype.removeIFrame=function(){this._iframe.parentElement.removeChild(this._iframe)};a.prototype.setupIFrame=function(){var b=this,c=document.getElementsByTagName("body")[0],d;d=document.createElement("iframe");d.style.display="none";d.style.width="1px";d.style.height="1px";var f=function(){b.handleOnLoad.apply(b,arguments)};"function"===typeof d.attachEvent?d.attachEvent("onload",f):d.onload=f;c.appendChild(d);this._iframe=
d;this._state=a.STATE_INITIALIZED};a.defaultBlankUri="/favicon.ico";a._instanceCount=0;a.STATE_UNINITIALIZED=0;a.STATE_INITIALIZED=1;a.STATE_LOADING=2;a.STATE_LOADED=3;d.WindowName=a})(econda||(econda={}));
(function(b){var d=b.ajax||(b.ajax={}),f=b.env.UserAgent,c=b.net.Uri,a=b.base.BaseClass,e=function(b){var c=a.call(this)||this;c._uri=null;c._method="get";c._params=null;c._headers={};c._data=null;c._writer=null;c._reader=null;c._success=null;c._error=null;c._callback=null;c._afterSend=null;c.timeoutMilliseconds=0;c._withCredentials=!1;c._transport=null;c._inititalized=!1;if(b instanceof e)return b;c.initConfig(b);return c};__extends(e,a);e.prototype.getUri=function(){return this._uri};e.prototype.setUri=
function(a){this._uri=new c(a);return this};e.prototype.getMethod=function(){return this._method};e.prototype.setMethod=function(a){this._method=a.toLocaleLowerCase();return this};e.prototype.getParams=function(){return this._params};e.prototype.setParams=function(a){this._params=a;return this};e.prototype.addParams=function(a,b){void 0===b&&(b=null);if("string"==typeof a)this._params[a]=b;else for(var c in a)this._params[c]=a[c];return this};e.prototype.getHeaders=function(){return this._headers};
e.prototype.setHeaders=function(a,b){this._headers={};return this.addHeaders.apply(this,arguments)};e.prototype.addHeaders=function(a,b){if("string"==typeof a)this._headers[a]=b;else for(var c in a)this._headers[c]=a[c];return this};e.prototype.hasHeaders=function(){if(Object.keys)return 0<Object.keys(this._headers).length;for(var a in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,a))return!0;return!1};e.prototype.getData=function(){return this._data};e.prototype.setData=function(a){this._data=
a;return this};e.prototype.getWriter=function(){return this._writer};e.prototype.setWriter=function(a){if("string"==typeof a)switch(a){case "form-encoded":this._writer=new b.ajax.writer.FormEncodedWriter;break;case "json":this._writer=new b.ajax.writer.JsonWriter;break;default:throw"Unsupported writer: "+a;}else this._writer=a;return this};e.prototype.getReader=function(){return this._reader};e.prototype.setReader=function(a){if("string"==typeof a)switch(a){case "json":this._reader=new b.ajax.reader.JsonReader;
break;default:throw"Unsupported response reader: "+a;}else this._reader=a;return this};e.prototype.getSuccess=function(){return this._success};e.prototype.setSuccess=function(a){this._success=a;return this};e.prototype.getError=function(){return this._error};e.prototype.setError=function(a){this._error=a;return this};e.prototype.getCallback=function(){return this._callback};e.prototype.setCallback=function(a){this._callback=a;return this};e.prototype.getAfterSend=function(){return this._afterSend};
e.prototype.setAfterSend=function(a){this._afterSend=a;return this};e.prototype.getTimeoutMilliseconds=function(){return this.timeoutMilliseconds};e.prototype.setTimeoutMilliseconds=function(a){this.timeoutMilliseconds=a;return this};e.prototype.setWithCredentials=function(a){this._withCredentials=a;return this};e.prototype.getWithCredentials=function(){return this._withCredentials};e.prototype.setTransport=function(a){if("string"===typeof a)switch(a.toLowerCase()){case "post":this._transport=new b.ajax.transport.Post;
break;case "get":this._transport=new b.ajax.transport.Get;break;case "windowname":this._transport=new b.ajax.transport.WindowName;break;default:throw Error("unknown transport: "+a);}else this._transport=a;this._transport.setRequest(this);return this};e.prototype.getTransport=function(){return this._transport};e.prototype.init=function(){null==this.getUri()&&b.debug.error("Trying to send request, but request has empty uri.");this._transport||this.autoDetectAndSetTransport();this._transport.init();
this._inititalized=!0};e.prototype.send=function(){!1==this._inititalized&&this.init();this._transport.send(this)};e.prototype.handleResponse=function(a){var b=this.getReader();a.data=b?b.read(a.responseText):a.responseText;a.isError?this._error&&this._error.call(this,a):this._success&&this._success.apply(this,[a.data]);this._callback&&this._callback.call(this,a)};e.prototype.autoDetectAndSetTransport=function(){if(!this._transport){var a;switch(this._method){case "get":a=this.isXDomainRequest()&&
f.getName()==f.INTERNET_EXPLORER&&10>f.getVersion()?new b.ajax.transport.WindowName:new b.ajax.transport.Get;break;case "post":a=new b.ajax.transport.Post;break;default:throw"Unsupported request method: "+this._method;}this.setTransport(a)}};e.prototype.isSupportedRequest=function(){this._transport||this.autoDetectAndSetTransport();return this._transport.isSupportedRequest()};e.prototype.isXDomainRequest=function(){var a=!1,b=this._uri.match(/^https?\:\/\/([^\/:?#]+)(?:[\/:?#]|$)/i);(b=b&&b[1])&&
b!=location.host&&(a=!0);return a};d.Request=e})(econda||(econda={}));(function(b){var b=b.ajax||(b.ajax={}),b=b.reader||(b.reader={}),d=function(){};d.prototype.read=function(b){return b};b.TextReader=d})(econda||(econda={}));(function(b){var d=b.ajax||(b.ajax={}),f=function(){};f.createRequest=function(c){return new b.ajax.Request(c)};f.request=function(b){b=this.createRequest(b);b.send();return b};d.Ajax=f})(econda||(econda={}));econda.Ajax=econda.ajax.Ajax;
(function(b){var d=b.recengine||(b.recengine={}),d=d.proxy||(d.proxy={}),f=b.recengine.response.Response,c=b.recengine.event.ProductAddToCartEvent,a=b.recengine.event.ProductBuyEvent,e=b.recengine.event.ProductViewEvent,g=b.util.DateUtils,j=b.base.BaseClass,h=function(a){void 0===a&&(a=null);var b=j.call(this)||this;b.uri=null;b.request=null;b._ajaxRequest=null;if(a instanceof h)return a;b.initConfig(a);return b};__extends(h,j);h.prototype.getUri=function(){return this.uri};h.prototype.setUri=function(a){this.uri=
a};h.prototype.setRequest=function(a){this.request=a};h.prototype.getRequest=function(){return this.request};h.prototype.getAjaxRequest=function(){return this._ajaxRequest};h.detectProtocol=function(){return"string"===typeof location.protocol&&"https:"===location.protocol?"https":"http"};h.prototype._isCookieRequired=function(){var a;return a=this.request.getAutoContext()};h.prototype.send=function(){var a=this.request,c=this,e=h.detectProtocol(),d=this.uri;d||(d=[e,"://widgets.crosssell.info/eps/crosssell/recommendations/",
a.getAccountId(),".do"].join(""));var e=this.getRecommendationServiceFormFieldParametersFromRequest(),f=this._ajaxRequest=b.ajax.Ajax.createRequest({uri:d,method:"post",writer:"form-encoded",reader:"json",data:e,withCredentials:c._isCookieRequired(),timeoutMilliseconds:a.getTimeoutMilliseconds(),success:function(a){c.handleSuccess(a)},error:function(){c.handleError()}});f.init();f.isSupportedRequest()||(f=this._ajaxRequest=b.ajax.Ajax.createRequest({uri:d,method:"get",reader:"json",params:e,withCredentials:c._isCookieRequired(),
timeoutMilliseconds:a.getTimeoutMilliseconds(),success:function(a){c.handleSuccess(a)},error:function(){c.handleError()}}));f.send()};h.prototype.handleError=function(){var a=new f({isError:!0});this.request.handleResponse(a)};h.prototype.handleSuccess=function(a){a?("undefined"===typeof a.products&&(a.products=a.items||[],delete a.items),"undefined"!==typeof a.widgetdetails&&(a.widgetDetails=a.widgetdetails,delete a.widgetdetails),"undefined"!==typeof a.start&&(a.startIndex=a.start,delete a.start),
"undefined"!==typeof a.end&&(a.endIndex=a.end,delete a.end),delete a.size,a=new f(a),a.setRequest(this.getRequest()),this.request.handleResponse(a)):this.handleError()};h.prototype.getRecommendationServiceFormFieldParametersFromRequest=function(){var d=this.request,f={};f.wid=d.getWidgetId();f.aid=d.getAccountId();f.type=d.getType();f.start=d.getStartIndex();f.widgetdetails=!0;var g=d.getChunkSize();g&&(f.csize=g);g=[];d.getAutoContext()&&(g=this._getAutoContextParamValue());if(d=d.getContext()){for(var h=
d.getProducts(),j=0;j<h.length;j++)h[j].getSku()?g.push("sku:"+h[j].getSku()):g.push(h[j].getId());h=d.getCategories();if(0<h.length)for(j=0;j<h.length;j++){var n=h[j],p="ctxcat";0<j&&(p+=j);f[p+".ct"]=n.getType();n.getId()&&(f[p+".cid"]=n.getId());n.getPath()&&(f[p+".paa"]=n.getPath());n.getVariant()&&(f[p+".pv"]=n.getVariant())}var h=d.getAttributes(),l;for(l in h)switch(h[l]){case null:f["ctxcustom."+l]="";break;default:f["ctxcustom."+l]=""+h[l]}d.getVisitorId()&&(f.emvid=d.getVisitorId());d.getCustomerId()&&
(f.emcid=d.getCustomerId());d.getRecipientId()&&(f.emrid=d.getRecipientId());d.getUserId()&&(f.emuid=d.getUserId());d.getEmail()&&(f.ememail=d.getEmail());d.getEmailHash()&&(f.ememailhash=d.getEmailHash());l=d.getProfileProperties();for(var m in l)l.hasOwnProperty(m)&&(f["p."+m]=l[m]);m=b.data.visitor.getHistory();f["p.ec:productBasketAddList"]=this._convertProductEventListToJsonParamValue(m.getFilteredItems(function(a){return a instanceof c}));f["p.ec:productBuyList"]=this._convertProductEventListToJsonParamValue(m.getFilteredItems(function(b){return b instanceof
a}));f["p.ec:productViewList"]=this._convertProductEventListToJsonParamValue(m.getFilteredItems(function(a){return a instanceof e}));f.timestamp=this._currentDateAsUtcIsoString();m=d.getProductsExcluded();f.excl=this._convertProductReferencesListToParamValue(m)}f.pid=g;return f};h.prototype._getAutoContextParamValue=function(){for(var a=[],c=b.data.visitor.getHistory().getFilteredItems(function(a){return a instanceof e}),d,f=0;f<c.length;f++)if(d=c[f].getProduct())d.getSku()?a.push("sku:"+d.getSku()):
a.push(d.getId());return a.slice(-5).reverse()};h.prototype._currentDateAsUtcIsoString=function(){return g.toUtcIsoString(new Date)};h.prototype._convertProductEventListToJsonParamValue=function(a){for(var c=[],e=0;e<a.length;e++){var d;if(d=a[e].getProduct())null!==d.getSku()?c.push({t:g.toUtcIsoString(a[e].getTimestamp()),sku:d.getSku()}):c.push({t:g.toUtcIsoString(a[e].getTimestamp()),pid:d.getId()})}a=c.reverse();return b.util.Json.stringify(a)};h.prototype._convertProductReferencesListToParamValue=
function(a,b){for(var c=[],e="function"===typeof b?b:function(a){return a},d=0;d<a.length;d++){var f=e(a[d]);null!==f.getSku()?c.push("sku:"+f.getSku()):c.push(f.getId())}return c};d.AjaxProxy=h})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),f=b.recengine.context.Context,c=b.base.BaseClass,a=function(b){void 0===b&&(b=null);var d=c.call(this)||this;d.widgetId=null;d.accountId=null;d.startIndex=0;d.chunkSize=null;d.context=null;d.defaultContextEnabled=!0;d.autoContext=!1;d.type=a.TYPE_CROSS_SELL;d.decorators=[];d.proxy=null;d.success=null;d._error=null;d.timeoutMilliseconds=0;d._callback=null;d.requestWasSuccessful=null;if(b instanceof a)return b;d.initConfig(b);return d};__extends(a,c);
a.prototype.getWidgetId=function(){return this.widgetId};a.prototype.setWidgetId=function(a){this.widgetId=a;return this};a.prototype.getAccountId=function(){return this.accountId||econdaConfig.crosssellAccountId};a.prototype.setAccountId=function(a){this.accountId=a;return this};a.prototype.getStartIndex=function(){return this.startIndex};a.prototype.setStartIndex=function(a){this.startIndex=a;return this};a.prototype.getChunkSize=function(){return this.chunkSize};a.prototype.setChunkSize=function(a){this.chunkSize=
a;return this};a.prototype.getContext=function(){return this.defaultContextEnabled?this.context||new f:this.context};a.prototype.setContext=function(a){this.context=new f(a);return this};a.prototype.getDefaultContextEnabled=function(){return this.defaultContextEnabled};a.prototype.setDefaultContextEnabled=function(a){this.defaultContextEnabled=!0===a};a.prototype.getAutoContext=function(){return this.autoContext};a.prototype.setAutoContext=function(a){this.autoContext=a;return this};a.prototype.getType=
function(){return this.type};a.prototype.setType=function(c){c!==a.TYPE_CROSS_SELL&&c!==a.TYPE_AD_REQUEST&&b.debug.error("Trying to set invalid cross sell request type: "+c);this.type=c;return this};a.prototype.getDecorators=function(){return this.decorators};a.prototype.setDecorators=function(a){var b=this;return this.setArray("decorators",a,null,{callback:function(a){a.setRequest(b)}})};a.prototype.addDecorators=function(a){var b=this;return this.addArray("decorators",a,null,{callback:function(a){a.setRequest(b)}})};
a.prototype.getProxy=function(){return this.proxy};a.prototype.setProxy=function(a){if("string"===typeof a){var c=b.util.StringUtils.ucFirst(a);if("undefined"!==typeof b.recengine.proxy[c])this.proxy=new b.recengine.proxy[c];else throw"proxy not supported: "+a;}else this.proxy=a;this.proxy&&"undefined"!==typeof this.proxy.setRequest&&this.proxy.setRequest(this);return this};a.prototype.getSuccess=function(){return this.success};a.prototype.setSuccess=function(a){this.success=a;return this};a.prototype.getError=
function(){return this._error};a.prototype.setError=function(a){this._error=a;return this};a.prototype.getTimeoutMilliseconds=function(){return this.timeoutMilliseconds};a.prototype.setTimeoutMilliseconds=function(a){this.timeoutMilliseconds=a;return this};a.prototype.getCallback=function(){return this._callback};a.prototype.setCallback=function(a){this._callback=a;return this};a.prototype.send=function(){var a=this.proxy;a||(a=new b.recengine.proxy.AjaxProxy,a.setRequest(this));this._validateAndLogErrors();
a.send()};a.prototype.getRecommendationServiceParameters=function(){var a=this.proxy;a||(a=new b.recengine.proxy.AjaxProxy,a.setRequest(this));return a.getRecommendationServiceFormFieldParametersFromRequest()};a.prototype._validateAndLogErrors=function(){this.getAccountId()||b.debug.error("Missing crosssell account id in request.",this);this.getWidgetId()||b.debug.error("Missing widget id in request",this)};a.prototype.handleResponse=function(a){a.getIsError()?"function"===typeof this._error&&this._error():
(this.processResponseDecorators(a),"function"===typeof this.success&&this.success(a));"function"===typeof this._callback&&this._callback(a)};a.prototype.processResponseDecorators=function(a){var c=a.getWidgetDetails();if((c=c&&c.getTracking())&&!0===c.getEmcs()){var d="",f=this.getContext();f&&0<f.getProducts().length&&(d=f.getProducts()[0].getId());this.addDecorators(new b.recengine.decorator.PerformanceTracking({position:c.getEmcs1(),source:d,widgetName:c.getEmcs0()}))}for(c=0;c<this.decorators.length;c++)this.decorators[c].decorate(a)};
a.TYPE_CROSS_SELL="cs";a.TYPE_AD_REQUEST="ac";d.Request=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.widget||(d.widget={}),d=d.renderer||(d.renderer={}),f=b.base.BaseClass,c=function(a){void 0===a&&(a=null);var b=f.call(this)||this;b.widget=null;b.rendererFn=null;b.scope=null;if(a instanceof c)return a;b.initConfig(a);return b};__extends(c,f);c.prototype.getWidget=function(){return this.widget};c.prototype.setWidget=function(a){this.widget=a};c.prototype.getRendererFn=function(){return this.rendererFn};c.prototype.setRendererFn=function(a){this.rendererFn=
a;return this};c.prototype.getScope=function(){return this.scope};c.prototype.setScope=function(a){this.scope=a;return this};c.prototype.render=function(a){if(!this.rendererFn)throw"Widget FunctionRenderer requires a renderer function to be set. No renderer function found. Check widget.renderer.rendererFn.";var c=b.util.DomHelper.element(this.getWidget().getElement());return this.rendererFn.call(this.scope||this,a,c,b.util.StringUtils)};d.FunctionRenderer=c})(econda||(econda={}));
(function(b){var d=b.templating||(b.templating={}),f=b.net.Uri,c=b.util.DomHelper,a=b.base.BaseClass,e=function(b){var c=a.call(this)||this;c._engineInstance=null;c.uri=null;c.template=null;c.engine="ejs";c._element=null;if(b instanceof e)return b;c.initConfig(b,"uri");return c};__extends(e,a);e.prototype.getUri=function(){return this.uri};e.prototype.setUri=function(a){this.uri=new f(a);return this};e.prototype.getTemplate=function(){return this.template};e.prototype.setTemplate=function(a){this.template=
a;return this};e.prototype.getEngine=function(){return this.engine};e.prototype.setEngine=function(a){a=a.toLowerCase();if("ejs"!=a)throw"It's not possible to change the template engine in this version.";return this};e.prototype.getElement=function(){return this._element};e.prototype.setElement=function(a){this._element=a;return this};e.prototype.render=function(a){void 0===a&&(a=null);var c=this.getUri(),e=this.getTemplate(),d=this.getElement();!c&&(!e&&!d)&&b.debug.error("Cannot render template: No template or uri found.");
d&&(d=this._readTemplateSourceFromDom(d))&&(e=d);null==this._engineInstance&&("undefined"==typeof EJS&&b.debug.error("EJS is undefined. Make sure EJS is included from lib directory."),this._engineInstance=new EJS({url:c?c.toString():null,text:e}));return this._engineInstance.render(a)};e.prototype._readTemplateSourceFromDom=function(a){var a=c.element(a),b=null;if(!a)return null;for(var b=a.innerHTML,e=0;e<a.childNodes.length;e++)if(8==a.childNodes[e].nodeType){b=a.childNodes[e].textContent;break}return b.trim().replace("&lt;%",
"<%").replace("%&gt;","%>")};d.Template=e})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.widget||(d.widget={}),d=d.renderer||(d.renderer={}),f=b.net.Uri,c=b.base.BaseClass,a=function(b){var d=c.call(this)||this;d._widget=null;d._uri=null;d._template=null;if(b instanceof a)return b;d.initConfig(b);return d};__extends(a,c);a.prototype.setWidget=function(a){this._widget=a};a.prototype.setUri=function(a){this._uri=null==a?null:new f(a);return this};a.prototype.getUri=function(){return this._uri};a.prototype.getTemplate=function(){return this._template};
a.prototype.setTemplate=function(a){this._template=a;return this};a.prototype.getElement=function(){return this._element};a.prototype.setElement=function(a){this._element=a;return this};a.prototype.render=function(a){var c=this.getUri(),d=this.getTemplate(),f=this.getElement(),c=new b.templating.Template({uri:c,template:d,element:f});try{return c.render(a)}catch(i){(a=this._widget.getError())&&a()}};d.TemplateRenderer=a})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.widget||(d.widget={}),d=d.renderer||(d.renderer={}),f=b.base.BaseClass,c=function(a){void 0===a&&(a=null);var b=f.call(this)||this;b.widget=null;b.template="econda.htm";b.callback=null;if(a instanceof c)return a;b.initConfig(a);return b};__extends(c,f);c.prototype.getWidget=function(){return this.widget};c.prototype.setWidget=function(a){this.widget=a};c.prototype.getTemplate=function(){return this.template};c.prototype.setTemplate=function(a){this.template=
a;return this};c.prototype.getCallback=function(){return this.callback};c.prototype.setCallback=function(a){this.callback=a;return this};c.prototype.render=function(a){var c=b.util.DomHelper.element(this.getWidget().getElement()),d=this.getTemplate(),f=this.getCallback();null!=f&&f(c,a,d);return!1};d.WebsaleRenderer=c})(econda||(econda={}));
(function(b){var d=b.condition||(b.condition={}),f=b.base.BaseClass,c=function(a){var b=f.call(this)||this;b._conditions=[];if(a instanceof c)return a;b.initConfig(a);return b};__extends(c,f);c.prototype.areTrue=function(){for(var a=0,b=this._conditions.length;a<b;a++)if(!1===this._conditions[a].isTrue())return!1;return!0};c.prototype.add=function(a){this.addArray("_conditions",a);return this};c.prototype.clear=function(){this._conditions=[];return this};d.ConditionContainer=c})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.widget||(d.widget={}),f=b.base.BaseClass,c=function(a){var e=f.call(this)||this;e._widget=null;e._template=null;e._image=null;if(a instanceof c)return a;if(a instanceof b.net.Uri)return e._constructWithConfigString(a.toString()),e;if("string"==typeof a)return e._constructWithConfigString(a),e;"object"==typeof a&&null!==a&&e._constructWithConfigObject(a);return e};__extends(c,f);c.prototype.setWidget=function(a){this._widget=a};c.prototype.getWidget=
function(){return this._widget};c.prototype.getTemplate=function(){return this._template};c.prototype.setTemplate=function(a){this._template="string"==typeof a?a.match(/\.html?/i)?{uri:a}:{template:a}:a;return this};c.prototype.getImage=function(){return this._image};c.prototype.setImage=function(a){this._image=null===a?null:new b.net.Uri(a);return this};c.prototype._constructWithConfigObject=function(a){if(a.id||a.widgetId)this._widget=a;else if(a.uri||a.template)this._template=a};c.prototype._constructWithConfigString=
function(a){a.match(/\.html?/i)?this._template={uri:a}:a.match(/\.(png|jpg|jpeg|gif)/i)?this._image=new b.net.Uri(a):this._template={template:a}};d.FallbackConfig=c})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.widget||(d.widget={}),f=b.base.BaseClass,c=function(a){var b=f.call(this)||this;b._element=null;b._config=null;b._allowCrossSellRequests=!0;b._callback=null;if(a instanceof c)return a;b.initConfig(a);return b};__extends(c,f);c.prototype.getElement=function(){return this._element};c.prototype.setElement=function(a){this._element=a;return this};c.prototype.getConfig=function(){return this._config};c.prototype.setConfig=function(a){this._config=a;
return this};c.prototype.getAllowCrossSellRequests=function(){return this._allowCrossSellRequests};c.prototype.setAllowCrossSellRequests=function(a){this._allowCrossSellRequests=a;return this};c.prototype.getCallback=function(){return this._callback};c.prototype.setCallback=function(a){this._callback=a;return this};c.prototype.execute=function(){this._tryRenderFallbackWidget()};c.prototype._tryRenderFallbackWidget=function(){var a=this,c=this._config;null!==c.getWidget()&&this._allowCrossSellRequests?
(c=c.getWidget(),c=new b.recengine.Widget(c),c.setElement(this.getElement()),c.setAfterRender(function(b,c){!1===c?a._tryRenderFallbackTemplate():a._exitStatusSuccess()}),c.render()):this._tryRenderFallbackTemplate()};c.prototype._tryRenderFallbackTemplate=function(){var a=this._config;null!==a.getTemplate()?(a=a.getTemplate(),a=(new b.templating.Template(a)).render(),b.util.DomHelper.update(this.getElement(),a),this._exitStatusSuccess()):this._tryRenderFallbackImage()};c.prototype._tryRenderFallbackImage=
function(){var a;if(null!==this._config.getImage()&&(a=this.getElement())){b.util.DomHelper.empty(a);var c=document.createElement("img");c.src=this._config.getImage().toString();a.appendChild(c);this._exitStatusSuccess()}else this._exitStatusFailure()};c.prototype._exitStatusSuccess=function(){"function"==typeof this._callback&&this._callback({success:!0})};c.prototype._exitStatusFailure=function(){"function"==typeof this._callback&&this._callback({success:!1})};d.FallbackHandler=c})(econda||(econda=
{}));
(function(b){var d=b.recengine||(b.recengine={}),f,c=d.Request,a=function(e){var d=c.call(this)||this;d.element=null;d.removeIfEmpty=!1;d.empty=null;d.setEmpty=function(a){this.empty=a;return this};d.emptyThreshold=null;d.renderer=null;d.afterRender=null;d._preConditions=new b.condition.ConditionContainer;d._fallback=null;if(e instanceof a)return e;d.initConfig(e);return d};__extends(a,c);a.prototype.getId=function(){return this.getWidgetId()};a.prototype.setId=function(a){this.setWidgetId(a);return this};
a.prototype.getElement=function(){return this.element};a.prototype.setElement=function(a){this.element=a;return this};a.prototype.getRemoveIfEmpty=function(){return this.removeIfEmpty};a.prototype.setRemoveIfEmpty=function(a){this.removeIfEmpty=a;return this};a.prototype.getEmpty=function(){return this.empty};a.prototype.getEmptyThreshold=function(){return null!=this.emptyThreshold?this.emptyThreshold:this.chunkSize};a.prototype.setEmptyThreshold=function(a){this.emptyThreshold=a;return this};a.prototype.getRenderer=
function(){return this.renderer};a.prototype.setRenderer=function(a){if("string"==typeof a)return this.renderer=this.createAndReturnRenderer(a),this;if(a&&a.type)return this.renderer=this.createAndReturnRenderer(a.type,a),this;this.renderer=a;return this};a.prototype.setAfterRender=function(a){this.afterRender=a;return this};a.prototype.getAfterRender=function(){return this.afterRender};a.prototype.setPreConditions=function(a){this._preConditions.clear();this.addPreConditions(a);return this};a.prototype.addPreConditions=
function(a){if(b.util.ArrayUtils.isArray(a))for(var c=0;c<a.length;c++)this._preConditions.add(a[c]);else this._preConditions.add(a);return this};a.prototype.setFallback=function(a){this._fallback=new b.recengine.widget.FallbackConfig(a);return this};a.prototype.getFallback=function(){return this._fallback};a.prototype.createAndReturnRenderer=function(a,c){void 0===c&&(c=null);var d=b.util.StringUtils.ucFirst(a)+"Renderer";if("undefined"==typeof b.recengine.widget.renderer[d])throw"Unknown renderer type: "+
a;"undefined"!=typeof c.type&&delete c.type;return new b.recengine.widget.renderer[d](c)};a.prototype.send=function(){c.prototype.send.call(this)};a.prototype.render=function(){return this.send()};a.prototype.handleResponse=function(a){c.prototype.handleResponse.call(this,a);!0===a.getIsError()?this._onErrorResponse(a):a.products.length<this.getEmptyThreshold()?this._onEmptyResponse(a):this._onSuccessfulResponse(a)};a.prototype._onSuccessfulResponse=function(a){this.requestWasSuccessful=!0;if(this.renderer){var c=
null;this.renderer.setWidget(this);c=this.renderer.render(a);!1!==c&&b.util.DomHelper.update(this.element,c);"function"==typeof this.afterRender&&this.afterRender.call(this,this.requestWasSuccessful)}};a.prototype._onErrorResponse=function(){var a=this;this.requestWasSuccessful=!1;this._executeFallback(!1,function(){"function"==typeof this.afterRender&&a.afterRender.call(a,a.requestWasSuccessful)})};a.prototype._onEmptyResponse=function(a){var c=this;this.requestWasSuccessful=!1;var d=function(){"function"==
typeof c.afterRender&&c.afterRender.call(c,c.requestWasSuccessful);"function"==typeof c.empty&&c.empty.call(c,a)};this.removeIfEmpty?(b.util.DomHelper.remove(this.element),"function"==typeof this.empty&&this.empty.call(this,a)):this._executeFallback(!0,d)};a.prototype._executeFallback=function(a,c){void 0===a&&(a=!0);void 0===c&&(c=null);null!==this._fallback?(new b.recengine.widget.FallbackHandler({config:this._fallback,element:this.element,allowCrossSellRequests:a,callback:c})).execute():"function"==
typeof c&&c({success:!1})};a.renderWidgetsFromConfigArray=function(b){for(var c=0;c<b.length;c++)(new a(b[c])).render()};f=a;d.Widget=f;d=function(){"undefined"!=typeof ecWidgets&&f.renderWidgetsFromConfigArray(ecWidgets)};b.util.DomHelper.isDocumentReady()?d():b.util.DomHelper.documentReady(d)})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),d=d.proxy||(d.proxy={}),f=b.recengine.proxy.AjaxProxy,c=function(){return null!==f&&f.apply(this,arguments)||this};__extends(c,f);c.prototype._getClientId=function(){var a=this.getRequest().getAccountId();return null==a||10>a.length?(b.debug.error("Invalid account id in cross sell request: "+a),null):a.substr(0,8)};c.prototype._getRequestUri=function(){var a=this.getRequest().getAccountId(),b=f.detectProtocol(),c=this._getClientId();return b+"://cross.econda-monitor.de/l/"+
c+"/"+a+".do"};c.prototype._isCookieRequired=function(){return!0};c.prototype.send=function(){if(null==this.getUri()){var a=this._getRequestUri();this.setUri(a)}f.prototype.send.call(this)};d.AdProxy=c})(econda||(econda={}));
(function(b){var d=b.recengine||(b.recengine={}),f=d.Widget,c=function(a){void 0===a&&(a=null);var c=f.call(this)||this;c.setType("ac");c.setDefaultContextEnabled(!1);c.initConfig(a);c.setProxy(new b.recengine.proxy.AdProxy);return c};__extends(c,f);c.renderAdWidgetsFromConfigArray=function(a){for(var b=0;b<a.length;b++)(new c(a[b])).render()};d.AdWidget=c;d=function(){"undefined"!=typeof ecAdWidgets&&c.renderAdWidgetsFromConfigArray(ecAdWidgets)};b.util.DomHelper.isDocumentReady()?d():b.util.DomHelper.documentReady(d)})(econda||
(econda={}));(function(b){var d=b.recengine||(b.recengine={}),f=d.Request,c=function(a){void 0===a&&(a=null);var e=f.call(this)||this;if(a instanceof c)return a;e.setType(d.Request.TYPE_AD_REQUEST);e.setDefaultContextEnabled(!1);e.initConfig(a);e.setProxy(new b.recengine.proxy.AdProxy);return e};__extends(c,f);d.AdRequest=c})(econda||(econda={}));
(function(b){var d=b.profileaccess||(b.profileaccess={}),d=d.context||(d.context={}),f=b.base.BaseClass,c=function(a){var b=f.call(this)||this;b.profileProperties={};b.visitorId=null;b.customerId=null;b.recipientId=null;b.userId=null;b.email=null;b.emailHash=null;b._appendVisitorData=null;a=a||{};if(a instanceof c)return a;"undefined"!=typeof a.appendVisitorData&&(b._appendVisitorData=!0===a.appendVisitorData,delete a.appendVisitorData);b.initConfig(a);!0===b._appendVisitorData&&b._doAppendVisitorData();
return b};__extends(c,f);c.prototype.setProfileProperties=function(a){this.profileProperties=a};c.prototype.getProfileProperties=function(){return this.profileProperties};c.prototype.setVisitorId=function(a){this.visitorId=a;return this};c.prototype.getVisitorId=function(){return this.visitorId};c.prototype.setCustomerId=function(a){this.customerId=a;return this};c.prototype.getCustomerId=function(){return this.customerId};c.prototype.setRecipientId=function(a){this.recipientId=a;return this};c.prototype.getRecipientId=
function(){return this.recipientId};c.prototype.setUserId=function(a){this.userId=a;return this};c.prototype.getUserId=function(){return this.userId};c.prototype.setEmail=function(a){this.email=a;return this};c.prototype.getEmail=function(){return this.email};c.prototype.setEmailHash=function(a){this.emailHash=a;return this};c.prototype.getEmailHash=function(){return this.emailHash};c.prototype._doAppendVisitorData=function(){try{var a=b.data.visitor;this.setVisitorId(a.getVisitorId());this.setCustomerId(a.getCustomerId());
this.setUserId(a.getUserId());this.setRecipientId(a.getRecipientId());this.setEmail(a.getEmail());this.setEmailHash(a.getEmailHash());this.setProfileProperties(a.getProperties())}catch(c){b.debug.error("Could not append visitor profile data to cross sell request due to an internal exception: "+c)}};d.Context=c})(econda||(econda={}));
(function(b){var d=b.profileaccess||(b.profileaccess={}),f=b.profileaccess.context.Context,c=b.base.BaseClass,a=function(b){void 0===b&&(b=null);var d=c.call(this)||this;d.endpointKey=null;d.accountId=null;d.context=null;d.defaultContextEnabled=!0;d.proxy=null;d.success=null;d._error=null;d._callback=null;d.requestWasSuccessful=null;if(b instanceof a)return b;d.initConfig(b);return d};__extends(a,c);a.prototype.getEndpointKey=function(){return this.endpointKey};a.prototype.setEndpointKey=function(a){this.endpointKey=
a;return this};a.prototype.getAccountId=function(){return this.accountId||econdaConfig.crosssellAccountId};a.prototype.setAccountId=function(a){this.accountId=a;return this};a.prototype.getContext=function(){return this.defaultContextEnabled?this.context||new f:this.context};a.prototype.setContext=function(a){this.context=new f(a);return this};a.prototype.getDefaultContextEnabled=function(){return this.defaultContextEnabled};a.prototype.setDefaultContextEnabled=function(a){this.defaultContextEnabled=
!0===a};a.prototype.getProxy=function(){return this.proxy};a.prototype.setProxy=function(a){if("string"===typeof a){var c=b.util.StringUtils.ucFirst(a);if("undefined"!==typeof b.profileaccess.proxy[c])this.proxy=new b.profileaccess.proxy[c];else throw"proxy not supported: "+a;}else this.proxy=a;this.proxy&&"undefined"!==typeof this.proxy.setRequest&&this.proxy.setRequest(this);return this};a.prototype.getSuccess=function(){return this.success};a.prototype.setSuccess=function(a){this.success=a;return this};
a.prototype.getError=function(){return this._error};a.prototype.setError=function(a){this._error=a;return this};a.prototype.getCallback=function(){return this._callback};a.prototype.setCallback=function(a){this._callback=a;return this};a.prototype.send=function(){var a=this.proxy;a||(a=new b.profileaccess.proxy.AjaxProxy,a.setRequest(this));this._validateAndLogErrors();a.send()};a.prototype._validateAndLogErrors=function(){this.getAccountId()||b.debug.error("Missing crosssell account id in request.",
this);this.getEndpointKey()||b.debug.error("Missing endpoint key in request",this)};a.prototype.handleResponse=function(a){a.isError?"function"===typeof this._error&&this._error(a):"function"===typeof this.success&&this.success(a);"function"===typeof this._callback&&this._callback(a)};d.Request=a})(econda||(econda={}));
(function(b){var d=b.profileaccess||(b.profileaccess={}),d=d.proxy||(d.proxy={}),f=b.base.BaseClass,c=function(a){void 0===a&&(a=null);var b=f.call(this)||this;b.uri=null;b.serviceUri=null;b.request=null;b._ajaxRequest=null;if(a instanceof c)return a;b.initConfig(a);return b};__extends(c,f);c.prototype.getUri=function(){return this.uri};c.prototype.setUri=function(a){this.uri=a};c.prototype.getServiceUri=function(){return this.serviceUri};c.prototype.setServiceUri=function(a){this.serviceUri=a};c.prototype.setRequest=
function(a){this.request=a};c.prototype.getRequest=function(){return this.request};c.prototype.getAjaxRequest=function(){return this._ajaxRequest};c.prototype.send=function(){var a=this,c=this.uri;c||(c=this.getEndpointUri());var d=this.getEndpointParameters(),f=this.getHeaderValues();(this._ajaxRequest=b.ajax.Ajax.createRequest({uri:c,method:"get",reader:"json",params:d,headers:f,success:function(b){a.handleSuccess(b)},error:function(b){a.handleError(b)}})).send()};c.prototype.getEndpointUri=function(){var a=
this.uri,c=this.request;if(!a){var a=b.net.Uri.detectProtocol(),d=this.getServiceUri();d||(d="services.crosssell.info/profileaccess");a=[a,"://",d,"/",c.getAccountId(),"/profiles/",c.getEndpointKey()].join("")}return a};c.prototype.handleError=function(a){if(!a||!a.isError)a={isError:!0};this.request.handleResponse(a)};c.prototype.handleSuccess=function(a){a?this.request.handleResponse(a):this.handleError(null)};c.prototype.getEndpointParameters=function(){return{}};c.prototype.getHeaderValues=function(){return{}};
d.AjaxProxy=c})(econda||(econda={}));
(function(b){var d=b.profileaccess||(b.profileaccess={}),d=d.proxy||(d.proxy={}),f=b.profileaccess.proxy.AjaxProxy,b=function(){return null!==f&&f.apply(this,arguments)||this};__extends(b,f);b.prototype.getEndpointParameters=function(){var b={},a=this.getRequest().getContext();a&&(a.getVisitorId()&&(b.emvid=a.getVisitorId()),a.getCustomerId()&&(b.emcid=a.getCustomerId()),a.getRecipientId()&&(b.emrid=a.getRecipientId()),a.getUserId()&&(b.emuid=a.getUserId()),a.getEmail()&&(b.ememail=a.getEmail()),
a.getEmailHash()&&(b.ememailhash=a.getEmailHash()));return b};d.PublicEndpointProxy=b})(econda||(econda={}));(function(b){var d=b.profileaccess||(b.profileaccess={}),f=d.Request,c=function(a){void 0===a&&(a=null);var d=f.call(this)||this;if(a instanceof c)return a;d.initConfig(a);d.getProxy()||d.setProxy(new b.profileaccess.proxy.PublicEndpointProxy);return d};__extends(c,f);d.PublicEndpointRequest=c})(econda||(econda={}));
(function(b){var d=b.profileaccess||(b.profileaccess={}),d=d.proxy||(d.proxy={}),f=b.profileaccess.proxy.AjaxProxy,b=function(){return null!==f&&f.apply(this,arguments)||this};__extends(b,f);b.prototype.getHeaderValues=function(){var b={},a=this.getRequest();a.getWebToken()&&(b["X-AUTH-TOKEN"]=a.getWebToken());return b};d.WebtokenEndpointProxy=b})(econda||(econda={}));
(function(b){var d=b.profileaccess||(b.profileaccess={}),f=d.Request,c=function(a){void 0===a&&(a=null);var d=f.call(this)||this;d.webToken=null;if(a instanceof c)return a;d.initConfig(a);d.getProxy()||d.setProxy(new b.profileaccess.proxy.WebtokenEndpointProxy);return d};__extends(c,f);c.prototype.getWebToken=function(){return this.webToken};c.prototype.setWebToken=function(a){this.webToken=a;return this};c.prototype._validateAndLogErrors=function(){f.prototype._validateAndLogErrors.call(this);this.getWebToken()||
b.debug.error("Missing webtoken in request",this)};d.WebTokenEndpointRequest=c})(econda||(econda={}));
(function(b){var d=b.tracking||(b.tracking={}),f=b.tracking.PluginManager,c=function(){};c.getInstance=function(){null===c._instance&&(c._instance=new c);return c._instance};c.prototype.onRequest=function(a,c){b.debug.log("Tracking request",a,c)};c.enable=function(){f.registerPlugin(c.getInstance())};c.disable=function(){f.unregisterPlugin(c.getInstance())};c._instance=null;d.DebugLogger=c;("undefined"!==typeof econdaConfig.trackingLogRequests&&!0==econdaConfig.trackingLogRequests||"undefined"===
typeof econdaConfig.trackingLogRequests&&!0==econdaConfig.debug)&&c.enable()})(econda||(econda={}));
(function(b){var d=b.tracking||(b.tracking={}),f=b.cookie.Store,c=b.tracking.VisitorId,a=function(){};a.prototype.onAfterRequest=function(d,f){var j=this;f.isTrackThirdParty()&&!f.doNotTrack()&&!f.isSyncCacheId()&&0<f.VCL?this.requestThirdPartyVisitorId(function(a){"string"===typeof a&&6<a.length&&c.update(a,{domain:f.getCookieDomain(),expires:f.getClientCookieLifetime()});j.disableAndMarkSessionUpdated()}):b.tracking.PluginManager.unregisterPlugin(a)};a.prototype.disableAndMarkSessionUpdated=function(){b.tracking.PluginManager.unregisterPlugin(a);
f.set({name:"ec_vid_updated",value:"1"})};a.prototype.requestThirdPartyVisitorId=function(a){try{var b=new XMLHttpRequest;b.withCredentials=!0;b.open("GET",this.buildServiceURL(),!0);b.onreadystatechange=function(){200==b.status&&a(b.responseText)};b.send()}catch(c){}};a.prototype.buildServiceURL=function(){return b.net.Uri.detectProtocol()+"://cross.econda-monitor.de/vi"};d.ThirdPartyVisitorIdPlugIn=a;"1"!==f.getValue("ec_vid_updated")&&b.tracking.PluginManager.registerPlugin(new a)})(econda||(econda=
{}));(function(b){b=b.privacyprotection||(b.privacyprotection={});b.STATE_UNKNOWN="UNKNOWN";b.STATE_ALLOW="ALLOW";b.STATE_DENY="DENY";b.Profile=function(){this.timestamp=0}})(econda||(econda={}));(function(b){var d=b.privacyprotection||(b.privacyprotection={});d.ProfilePermission=function(){this.profile=null;this.channels={};this.profile=new d.Profile}})(econda||(econda={}));
(function(b){var d=b.privacyprotection||(b.privacyprotection={}),f=function(a,b){if(a){b.arpprops||(b.arpprops=[]);if(a.profile){var c=a.profile.state?a.profile.state:"",d=a.profile.version?a.profile.version:"",e=a.profile.source?a.profile.source:"";b.arpprops.push(["PERMISSION","profile/"+c+"/"+d+"/"+e])}for(var f=Object.keys(a.channels),g=0;g<f.length;g++){var h=f[g],c=a.channels[h].state?a.channels[h].state:"",d=a.channels[h].version?a.channels[h].version:"",e=a.channels[h].source?a.channels[h].source:
"";b.arpprops.push(["PERMISSION","channel/"+h+"/"+c+"/"+d+"/"+e])}}},c=b.env.LocalStorage,a=b.privacyprotection.ProfilePermission,e=b.env.SessionStorage,g=b.util.Json,j=b.cookie.Store,h=b.base.BaseClass,i=function(){return null!==h&&h.apply(this,arguments)||this};__extends(i,h);i.PRIVACY_PROTECTION_KEY="econda.privacy.protection";i.PROFILE_STATE_KEY="profile.state";i.PRIVACY_PROTECTION_UPDATED_HASH="econda.privacy.updatehash";d.EmosPrivacy=i;d.hasProfileOptIn=function(){return"ALLOW"===d.getPermissionsFromLocalStorage().profile.state};
d.getProfileOptInVersion=function(){return d.getPermissionsFromLocalStorage().profile.version};d.hasChannelOptIn=function(a){return"ALLOW"===d.getPermissionsFromLocalStorage().channels[a].state};d.emptyIfNotProfileOptIn=function(a){return"ALLOW"===d.getPermissionsFromLocalStorage().profile.state?a:""};d.anonymiseIfNotProfileOptIn=function(a){if("ALLOW"===d.getPermissionsFromLocalStorage().profile.state)return a;var b=e.getItem("ecAnonValues."+a);if(!b||""===b)b="X-"+Date.now().toString(16)+Math.floor(4294967296*
Math.random()).toString(16),e.setItem("ecAnonValues."+a,b);return b};d.updatePrivacySettingsFromBackend=function(a,c){if(!a||"string"!==typeof a||!c||"string"!==typeof c)b.debug.log("updatePrivacySettingsFromBackend called with incorrect input",a,c);else if(b.data.visitor.getVisitorId()){var f=e.getItem(i.PRIVACY_PROTECTION_UPDATED_HASH),g=b.data.visitor.getIds();f!==d._getHashCodeFor(g)&&(d._callProfileEndpoint(a,c),e.setItem(i.PRIVACY_PROTECTION_UPDATED_HASH,d._getHashCodeFor(g)))}};d.getPermissionsFromLocalStorage=
function(){var d=new a;if(c.isAvailable()){var e=c.getItem(i.PRIVACY_PROTECTION_KEY);if(e)try{d=JSON.parse(e)}catch(f){console.log("Error parsing item from local storage")}else d.profile.state=b.privacyprotection.STATE_UNKNOWN}else d.profile.state=b.privacyprotection.STATE_UNKNOWN;return d};d._setEmosArpProps=f;d.setEmos3PrivacySettings=function(){var a=d.getPermissionsFromLocalStorage();k(a)};var k=function(a){window.emos3&&("ALLOW"===a.profile.state?(window.emos3.VCL=730,window.emos3.PARAM_TO_PROP_MERGE={ecmUid:"newsuid"}):(j.remove("emos_jcvid"),window.emos3.VCL=0,window.emos3.PARAM_TO_PROP_MERGE={ecmUid:null}))};d._callProfileEndpoint=function(a,c){(new b.profileaccess.PublicEndpointRequest({accountId:a,endpointKey:c,
context:{appendVisitorData:!0},success:function(a){d._endpointCallback(a)},error:function(a){b.debug.log("Error calling profile endpoint to get permissions"+c,a)}})).send()};d._endpointCallback=function(a){var a=d._convertExternalPermissionsToProfilePermissions(a),b=d.getPermissionsFromLocalStorage(),a=d._mergePermissions(b,a);c.setItem(i.PRIVACY_PROTECTION_KEY,JSON.stringify(a))};d._convertExternalPermissionsToProfilePermissions=function(b){var c=new a,d=b["permissions:profile"];if(d){var e=d.timestamp?
Date.parse(d.timestamp):(new Date).getTime();c.profile={state:d.state,version:d.version,source:d.source,timestamp:e}}if(b=b["permissions:channels"]){c.channels={};for(var d=Object.getOwnPropertyNames(b),f=0;f<d.length;f++){var g=d[f],e=b[g].timestamp?Date.parse(b[g].timestamp):(new Date).getTime();c.channels[g]={state:b[g].state,version:b[g].version,source:b[g].source,timestamp:e}}}return c};d._mergePermissions=function(b,c){var d=new a;d.profile=c.profile.timestamp?b.profile.timestamp?b.profile.timestamp>
c.profile.timestamp?b.profile:c.profile:c.profile:b.profile;d.channels={};for(var e=Object.keys(b.channels),f=Object.keys(c.channels),e=e.concat(f),f=0;f<e.length;f++){var g=e[f];d.channels[g]=c.channels[g]?b.channels[g]?b.channels[g].timestamp>c.channels[g].timestamp?b.channels[g]:c.channels[g]:c.channels[g]:b.channels[g]}return d};d._getHashCodeFor=function(a){if(a){var a=g.stringify(a),b=0,c=a.length,d=0;if(0<c)for(;d<c;)b=(b<<5)-b+a.charCodeAt(d++)|0;return b.toString()}}})(econda||(econda={}));
